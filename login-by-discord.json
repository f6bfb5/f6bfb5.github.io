{"title":"實作「使用 Discord 登入」","slug":"login-by-discord","html":"<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/masayoshi4649/items/46fdb744cb8255f5eb98#token%E3%81%A8%E5%85%B1%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%83%A6%E3%83%BC%E3%82%B6%E6%83%85%E5%A0%B1%E3%82%92%E5%BE%97%E3%82%8B\">「Discord の ID でログイン」を実装する(Oauth2) - Qiita</a></li>\n</ul>\n<h2 id=\"於-discord-developer-portal-登錄-application\">於 Discord Developer Portal 登錄 Application</h2>\n<h3 id=\"取得-「client-id」和「client-secert」\">取得 「Client ID」和「Client Secert」</h3>\n<ol>\n<li>登入 <a target=\"_blank\" rel=\"nofollow\" href=\"https://discord.com/developers/applications\">Discord Developer Portal</a></li>\n<li>點擊右上角的「New Application」</li>\n<li>取名，本例使用 <code>OAuth Vertify</code>，點擊「Create」</li>\n<li><code>Client ID</code> 和 <code>Client Secert</code> 位於資訊頁的右方</li>\n</ol>\n<h3 id=\"建立-oauth-用的網址\">建立 OAuth 用的網址</h3>\n<ol>\n<li>點擊左側的「OAuth2」</li>\n<li>點擊右側的「Add Redirect」，輸入驗證登入用的網址</li>\n<li>勾選下方「SCOPE」（索取的資訊欄位）裡的「identify」（Discord 的 ID）和「email」</li>\n<li>就可取得認證用的連結 <code>https://discord.com/api/oauth2/authorize?client_id=</code>CLIENT ID<code>&amp;redirect_uri=</code>REDIRECT URL<code>&amp;response_type=code&amp;scope=</code>SCOPE</li>\n</ol>\n<h2 id=\"於認證連結取得「code」\">於認證連結取得「Code」</h2>\n<ol>\n<li>於認證連結登入後，會回傳一個 <code>code</code> 參數到網址上</li>\n</ol>\n<h2 id=\"將「code」轉換成「token」\">將「Code」轉換成「Token」</h2>\n<ol>\n<li>傳送 POST 請求到 Discord API<blockquote>\n<p><code>curl -X POST -H &quot;Content-Type:application/x-www-form-urlencoded&quot; -d &quot;client_id=</code>CLIENT ID<code>&amp;client_secret=</code>CLIENT SECRET<code>&amp;grant_type=authorization_code&amp;code=</code>CODE<code>&amp;redirect_uri=</code>REDIRECT URL（要與認證 URL 相同）<code>&quot; https://discordapp.com/api/oauth2/token</code></p>\n</blockquote>\n</li>\n<li>若成功就可取得 Access Token<blockquote>\n<p><code>{&quot;access_token&quot;: </code>ACCESS TOKEN<code>, &quot;expires_in&quot;: 604800, &quot;refresh_token&quot;: </code>REFRESH TOKEN<code>, &quot;scope&quot;: </code>SCOPE<code>, &quot;token_type&quot;: &quot;Bearer&quot;}</code></p>\n</blockquote>\n</li>\n</ol>\n<ul>\n<li>Code 為一次性使用，同一個 code 無法存取第二次</li>\n<li>Access Token 的有效期限為 604800 秒＝一個禮拜，若有更新需求須使用 REFRESH TOKEN 重新請求</li>\n</ul>\n<h2 id=\"使用「token」取得使用者資料\">使用「Token」取得使用者資料</h2>\n<ol>\n<li>傳送 POST 請求到 Discord API\n<br><code>curl -H &quot;Authorization: Bearer </code>ACCESS TOKEN<code>&quot; https://discordapp.com/api/users/@me</code></li>\n<li>若成功就可取得 Access Token<blockquote>\n<p><code>{&quot;id&quot;: </code>Discord ID<code>, &quot;username&quot;: </code>使用者名稱<code>, &quot;avatar&quot;: </code>大頭貼 ID<code>, &quot;discriminator&quot;: </code>使用者編號(在名稱的#後面的數字)<code>, &quot;public_flags&quot;: 0, &quot;flags&quot;: 0, &quot;email&quot;: </code>信箱<code>, &quot;verified&quot;: true, &quot;locale&quot;: </code>使用語言<code>, &quot;mfa_enabled&quot;: false}</code></p>\n</blockquote>\n</li>\n</ol>\n<ul>\n<li>頭像可以使用 <code>https://cdn.discordapp.com/avatars/</code>Discord ID<code>/</code>大頭貼 ID 取得</li>\n</ul>\n<h2 id=\"使用-refresh-token-重新取得-access-token\">使用 REFRESH TOKEN 重新取得 ACCESS TOKEN</h2>\n<ol>\n<li>傳送 POST 請求到 Discord API<blockquote>\n<p><code>curl -X POST -H &quot;Content-Type:application/x-www-form-urlencoded&quot; -d &quot;client_id=</code>CLIENT ID<code>&amp;client_secret=</code>CLIENT SECRET<code>&amp;grant_type=refresh_token&amp;refresh_token=</code>REFRESH TOKEN<code>&quot; https://discordapp.com/api/oauth2/token</code></p>\n</blockquote>\n</li>\n<li>若成功就可取得 Access Token<blockquote>\n<p><code>{&quot;access_token&quot;: </code>ACCESS TOKEN<code>, &quot;expires_in&quot;: 604800, &quot;refresh_token&quot;: </code>REFRESH TOKEN<code>, &quot;scope&quot;: </code>SCOPE<code>, &quot;token_type&quot;: &quot;Bearer&quot;}</code></p>\n</blockquote>\n</li>\n</ol>\n","date":"2021-01-14T00:24:23.000Z","printDate":"January 14, 2021","printReadingTime":"2 min read"}