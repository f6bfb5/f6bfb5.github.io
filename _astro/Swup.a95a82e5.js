const $=new WeakMap;function A(i,t,e,s){if(!i&&!$.has(t))return!1;const n=$.get(t)??new WeakMap;$.set(t,n);const o=n.get(e)??new Set;n.set(e,o);const l=o.has(s);return i?o.add(s):o.delete(s),l&&i}function D(i,t){let e=i.target;if(e instanceof Text&&(e=e.parentElement),e instanceof Element&&i.currentTarget instanceof Element){const s=e.closest(t);if(s&&i.currentTarget.contains(s))return s}}function W(i,t,e,s={}){const{signal:n,base:o=document}=s;if(n?.aborted)return;const{once:l,...r}=s,a=o instanceof Document?o.documentElement:o,h=!!(typeof s=="object"?s.capture:s),u=g=>{const m=D(g,i);if(m){const f=Object.assign(g,{delegateTarget:m});e.call(a,f),l&&(a.removeEventListener(t,u,r),A(!1,a,e,c))}},c=JSON.stringify({selector:i,type:t,capture:h});A(!0,a,e,c)||a.addEventListener(t,u,r),n?.addEventListener("abort",()=>{A(!1,a,e,c)})}function d(){return d=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},d.apply(this,arguments)}const R=(i,t)=>String(i).toLowerCase().replace(/[\s/_.]+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")||t||"",y=({hash:i}={})=>location.pathname+location.search+(i?location.hash:""),V=(i,t={})=>{const e=d({url:i=i||y({hash:!0}),random:Math.random(),source:"swup"},t);history.pushState(e,"",i)},S=(i=null,t={})=>{i=i||y({hash:!0});const e=d({},history.state||{},{url:i,random:Math.random(),source:"swup"},t);history.replaceState(e,"",i)},_=(i,t,e,s)=>{const n=new AbortController;return s=d({},s,{signal:n.signal}),W(i,t,e,s),{destroy:()=>n.abort()}};class w extends URL{constructor(t,e=document.baseURI){super(t.toString(),e)}get url(){return this.pathname+this.search}static fromElement(t){const e=t.getAttribute("href")||t.getAttribute("xlink:href")||"";return new w(e)}static fromUrl(t){return new w(t)}}class P extends Error{constructor(t,e){super(t),this.url=void 0,this.status=void 0,this.aborted=void 0,this.timedOut=void 0,this.name="FetchError",this.url=e.url,this.status=e.status,this.aborted=e.aborted||!1,this.timedOut=e.timedOut||!1}}async function j(i,t={}){var e;i=w.fromUrl(i).url;const s=d({},this.options.requestHeaders,t.headers),n=(e=t.timeout)!=null?e:this.options.timeout,o=new AbortController,{signal:l}=o;t=d({},t,{headers:s,signal:l});let r,a=!1,h=null;n&&n>0&&(h=setTimeout(()=>{a=!0,o.abort("timeout")},n));try{r=await this.hooks.call("fetch:request",{url:i,options:t},(f,{url:v,options:b})=>fetch(v,b)),h&&clearTimeout(h)}catch(f){throw a?(this.hooks.call("fetch:timeout",{url:i}),new P(`Request timed out: ${i}`,{url:i,timedOut:a})):f?.name==="AbortError"||l.aborted?new P(`Request aborted: ${i}`,{url:i,aborted:!0}):f}const{status:u,url:c}=r,p=await r.text();if(u===500)throw this.hooks.call("fetch:error",{status:u,response:r,url:c}),new P(`Server error: ${c}`,{status:u,url:c});if(!p)throw new P(`Empty response: ${c}`,{status:u,url:c});const{url:g}=w.fromUrl(c),m={url:g,html:p};return!this.visit.cache.write||t.method&&t.method!=="GET"||i!==g||this.cache.set(m.url,m),m}class B{constructor(t){this.swup=void 0,this.pages=new Map,this.swup=t}get size(){return this.pages.size}get all(){const t=new Map;return this.pages.forEach((e,s)=>{t.set(s,d({},e))}),t}has(t){return this.pages.has(this.resolve(t))}get(t){const e=this.pages.get(this.resolve(t));return e&&d({},e)}set(t,e){e=d({},e,{url:t=this.resolve(t)}),this.pages.set(t,e),this.swup.hooks.callSync("cache:set",{page:e})}update(t,e){t=this.resolve(t);const s=d({},this.get(t),e,{url:t});this.pages.set(t,s)}delete(t){this.pages.delete(this.resolve(t))}clear(){this.pages.clear(),this.swup.hooks.callSync("cache:clear",void 0)}prune(t){this.pages.forEach((e,s)=>{t(s,e)&&this.delete(s)})}resolve(t){const{url:e}=w.fromUrl(t);return this.swup.resolveUrl(e)}}const H=(i,t=document)=>t.querySelector(i),L=(i,t=document)=>Array.from(t.querySelectorAll(i)),M=()=>new Promise(i=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{i()})})});function N(i){return!!i&&(typeof i=="object"||typeof i=="function")&&typeof i.then=="function"}function F(i,t=[]){return new Promise((e,s)=>{const n=i(...t);N(n)?n.then(e,s):e(n)})}const T=i=>window.CSS&&window.CSS.escape?CSS.escape(i):i,I=i=>1e3*Number(i.slice(0,-1).replace(",","."));class z{constructor(t){this.swup=void 0,this.swupClasses=["to-","is-changing","is-rendering","is-popstate","is-animating"],this.swup=t}get selectors(){const{scope:t}=this.swup.visit.animation;return t==="containers"?this.swup.visit.containers:t==="html"?["html"]:Array.isArray(t)?t:[]}get selector(){return this.selectors.join(",")}get targets(){return this.selector.trim()?L(this.selector):[]}add(...t){this.targets.forEach(e=>e.classList.add(...t))}remove(...t){this.targets.forEach(e=>e.classList.remove(...t))}clear(){this.targets.forEach(t=>{const e=t.className.split(" ").filter(s=>this.isSwupClass(s));t.classList.remove(...e)})}isSwupClass(t){return this.swupClasses.some(e=>t.startsWith(e))}}function K({to:i,from:t=this.currentPageUrl,hash:e,el:s,event:n}){return{id:Math.random(),from:{url:t},to:{url:i,hash:e},containers:this.options.containers,animation:{animate:!0,wait:!1,name:void 0,scope:this.options.animationScope,selector:this.options.animationSelector},trigger:{el:s,event:n},cache:{read:this.options.cache,write:this.options.cache},history:{action:"push",popstate:!1,direction:void 0},scroll:{reset:!0,target:void 0}}}class G{constructor(t){this.swup=void 0,this.registry=new Map,this.hooks=["animation:out:start","animation:out:await","animation:out:end","animation:in:start","animation:in:await","animation:in:end","animation:skip","cache:clear","cache:set","content:replace","content:scroll","enable","disable","fetch:request","fetch:error","fetch:timeout","history:popstate","link:click","link:self","link:anchor","link:newtab","page:load","page:view","scroll:top","scroll:anchor","visit:start","visit:transition","visit:end"],this.swup=t,this.init()}init(){this.hooks.forEach(t=>this.create(t))}create(t){this.registry.has(t)||this.registry.set(t,new Map)}exists(t){return this.registry.has(t)}get(t){const e=this.registry.get(t);if(e)return e;console.error(`Unknown hook '${t}'`)}clear(){this.registry.forEach(t=>t.clear())}on(t,e,s={}){const n=this.get(t);if(!n)return console.warn(`Hook '${t}' not found.`),()=>{};const o=d({},s,{id:n.size+1,hook:t,handler:e});return n.set(e,o),()=>this.off(t,e)}before(t,e,s={}){return this.on(t,e,d({},s,{before:!0}))}replace(t,e,s={}){return this.on(t,e,d({},s,{replace:!0}))}once(t,e,s={}){return this.on(t,e,d({},s,{once:!0}))}off(t,e){const s=this.get(t);s&&e?s.delete(e)||console.warn(`Handler for hook '${t}' not found.`):s&&s.clear()}async call(t,e,s){const{before:n,handler:o,after:l}=this.getHandlers(t,s);await this.run(n,e);const[r]=await this.run(o,e);return await this.run(l,e),this.dispatchDomEvent(t,e),r}callSync(t,e,s){const{before:n,handler:o,after:l}=this.getHandlers(t,s);this.runSync(n,e);const[r]=this.runSync(o,e);return this.runSync(l,e),this.dispatchDomEvent(t,e),r}async run(t,e){const s=[];for(const{hook:n,handler:o,defaultHandler:l,once:r}of t){const a=await F(o,[this.swup.visit,e,l]);s.push(a),r&&this.off(n,o)}return s}runSync(t,e){const s=[];for(const{hook:n,handler:o,defaultHandler:l,once:r}of t){const a=o(this.swup.visit,e,l);s.push(a),N(a)&&console.warn(`Promise returned from handler for synchronous hook '${n}'.Swup will not wait for it to resolve.`),r&&this.off(n,o)}return s}getHandlers(t,e){const s=this.get(t);if(!s)return{found:!1,before:[],handler:[],after:[],replaced:!1};const n=Array.from(s.values()),o=this.sortRegistrations,l=n.filter(({before:c,replace:p})=>c&&!p).sort(o),r=n.filter(({replace:c})=>c).filter(c=>!0).sort(o),a=n.filter(({before:c,replace:p})=>!c&&!p).sort(o),h=r.length>0;let u=[];if(e&&(u=[{id:0,hook:t,handler:e}],h)){const c=r.length-1,p=g=>{const m=r[g-1];return m?(f,v)=>m.handler(f,v,p(g-1)):e};u=[{id:0,hook:t,handler:r[c].handler,defaultHandler:p(c)}]}return{found:!0,before:l,handler:u,after:a,replaced:h}}sortRegistrations(t,e){var s,n;return((s=t.priority)!=null?s:0)-((n=e.priority)!=null?n:0)||t.id-e.id||0}dispatchDomEvent(t,e){document.dispatchEvent(new CustomEvent(`swup:${t}`,{detail:{hook:t,args:e,visit:this.swup.visit}}))}}const J=i=>{if(i&&i.charAt(0)==="#"&&(i=i.substring(1)),!i)return null;const t=decodeURIComponent(i);let e=document.getElementById(i)||document.getElementById(t)||H(`a[name='${T(i)}']`)||H(`a[name='${T(t)}']`);return e||i!=="top"||(e=document.body),e},k="transition",U="animation";async function X({elements:i,selector:t}){if(t===!1&&!i)return;let e=[];if(i)e=Array.from(i);else if(t&&(e=L(t,document.body),!e.length))return void console.warn(`[swup] No elements found matching animationSelector \`${t}\``);const s=e.map(n=>function(o){const{type:l,timeout:r,propCount:a}=function(h,u){const c=window.getComputedStyle(h),p=C(c,`${k}Delay`),g=C(c,`${k}Duration`),m=O(p,g),f=C(c,`${U}Delay`),v=C(c,`${U}Duration`),b=O(f,v);let E=null,x=0,q=0;return x=Math.max(m,b),E=x>0?m>b?k:U:null,q=E?E===k?g.length:v.length:0,{type:E,timeout:x,propCount:q}}(o);return!(!l||!r)&&new Promise(h=>{const u=`${l}end`,c=performance.now();let p=0;const g=()=>{o.removeEventListener(u,m),h()},m=f=>{if(f.target===o){if(!function(v){return[`${k}end`,`${U}end`].includes(v.type)}(f))throw new Error("Not a transition or animation event.");(performance.now()-c)/1e3<f.elapsedTime||++p>=a&&g()}};setTimeout(()=>{p<a&&g()},r+1),o.addEventListener(u,m)})}(n));s.filter(Boolean).length>0?await Promise.all(s):t&&console.warn(`[swup] No CSS animation duration defined on elements matching \`${t}\``)}function C(i,t){return(i[t]||"").split(", ")}function O(i,t){for(;i.length<t.length;)i=i.concat(i);return Math.max(...t.map((e,s)=>I(e)+I(i[s])))}function Q(i,t={},e={}){if(typeof i!="string")throw new Error("swup.navigate() requires a URL parameter");if(this.shouldIgnoreVisit(i,{el:e.el,event:e.event}))return void(window.location.href=i);const{url:s,hash:n}=w.fromUrl(i);this.visit=this.createVisit(d({},e,{to:s,hash:n})),this.performNavigation(t)}async function Y(i={}){this.navigating=!0;const t=this.visit,{el:e}=t.trigger;i.referrer=i.referrer||this.currentPageUrl,i.animate===!1&&(t.animation.animate=!1),t.animation.animate||this.classes.clear();const s=i.history||e?.getAttribute("data-swup-history")||void 0;s&&["push","replace"].includes(s)&&(t.history.action=s);const n=i.animation||e?.getAttribute("data-swup-animation")||void 0;var o,l;n&&(t.animation.name=n),typeof i.cache=="object"?(t.cache.read=(o=i.cache.read)!=null?o:t.cache.read,t.cache.write=(l=i.cache.write)!=null?l:t.cache.write):i.cache!==void 0&&(t.cache={read:!!i.cache,write:!!i.cache}),delete i.cache;try{await this.hooks.call("visit:start",void 0);const r=this.hooks.call("page:load",{options:i},async(a,h)=>{let u;return a.cache.read&&(u=this.cache.get(a.to.url)),h.page=u||await this.fetchPage(a.to.url,h.options),h.cache=!!u,h.page});if(!t.history.popstate){const a=t.to.url+t.to.hash;t.history.action==="replace"||t.to.url===this.currentPageUrl?S(a):(this.currentHistoryIndex++,V(a,{index:this.currentHistoryIndex}))}if(this.currentPageUrl=y(),t.animation.wait){const{html:a}=await r;t.to.html=a}await this.hooks.call("visit:transition",void 0,async a=>{const h=this.animatePageOut(),[u]=await Promise.all([r,h]);return a.id===this.visit.id&&(await this.renderPage(u),await this.animatePageIn(),!0)}),await this.hooks.call("visit:end",void 0,()=>this.classes.clear()),this.navigating=!1}catch(r){if(!r||r!=null&&r.aborted)return;console.error(r),this.options.skipPopStateHandling=()=>(window.location.href=t.to.url+t.to.hash,!0),window.history.go(-1)}}const Z=async function(){this.visit.animation.animate?(await this.hooks.call("animation:out:start",void 0,i=>{this.classes.add("is-changing","is-leaving","is-animating"),i.history.popstate&&this.classes.add("is-popstate"),i.animation.name&&this.classes.add(`to-${R(i.animation.name)}`)}),await this.hooks.call("animation:out:await",{skip:!1},async(i,{skip:t})=>{t||await this.awaitAnimations({selector:i.animation.selector})}),await this.hooks.call("animation:out:end",void 0)):await this.hooks.call("animation:skip",void 0)},tt=function({html:i},{containers:t}=this.options){var e;const s=new DOMParser().parseFromString(i,"text/html"),n=((e=s.querySelector("title"))==null?void 0:e.innerText)||"";document.title=n;const o=L('[data-swup-persist]:not([data-swup-persist=""])'),l=t.map(r=>{const a=document.querySelector(r),h=s.querySelector(r);return a&&h?(a.replaceWith(h),!0):(a||console.warn(`[swup] Container missing in current document: ${r}`),h||console.warn(`[swup] Container missing in incoming document: ${r}`),!1)}).filter(Boolean);return o.forEach(r=>{const a=r.getAttribute("data-swup-persist"),h=H(`[data-swup-persist="${a}"]`);h&&h!==r&&h.replaceWith(r)}),l.length===t.length},et=function(){const i={behavior:"auto"},{target:t,reset:e}=this.visit.scroll,s=t??this.visit.to.hash;let n=!1;return s&&(n=this.hooks.callSync("scroll:anchor",{hash:s,options:i},(o,{hash:l,options:r})=>{const a=this.getAnchorElement(l);return a&&a.scrollIntoView(r),!!a})),e&&!n&&(n=this.hooks.callSync("scroll:top",{options:i},(o,{options:l})=>(window.scrollTo(d({top:0,left:0},l)),!0))),n},it=async function(){if(!this.visit.animation.animate)return;const i=this.hooks.call("animation:in:await",{skip:!1},async(t,{skip:e})=>{e||await this.awaitAnimations({selector:t.animation.selector})});await M(),await this.hooks.call("animation:in:start",void 0,()=>{this.classes.remove("is-animating")}),await i,await this.hooks.call("animation:in:end",void 0)},st=async function(i){const{url:t,html:e}=i;this.classes.remove("is-leaving"),this.isSameResolvedUrl(y(),t)||(S(t),this.currentPageUrl=y(),this.visit.to.url=this.currentPageUrl),this.visit.animation.animate&&this.classes.add("is-rendering"),this.visit.to.html=e,await this.hooks.call("content:replace",{page:i},(s,{page:n})=>{if(!this.replaceContent(n,{containers:s.containers}))throw new Error("[swup] Container mismatch, aborting");s.animation.animate&&(this.classes.add("is-animating","is-changing","is-rendering"),s.animation.name&&this.classes.add(`to-${R(s.animation.name)}`))}),await this.hooks.call("content:scroll",void 0,()=>this.scrollToContent()),await this.hooks.call("page:view",{url:this.currentPageUrl,title:document.title})},nt=function(i){var t;if(t=i,!!t?.isSwupPlugin){if(i.swup=this,!i._checkRequirements||i._checkRequirements())return i._beforeMount&&i._beforeMount(),i.mount(),this.plugins.push(i),this.plugins}else console.error("Not a swup plugin instance",i)};function ot(i){const t=this.findPlugin(i);if(t)return t.unmount(),t._afterUnmount&&t._afterUnmount(),this.plugins=this.plugins.filter(e=>e!==t),this.plugins;console.error("No such plugin",t)}function rt(i){return this.plugins.find(t=>t===i||t.name===i||t.name===`Swup${String(i)}`)}function at(i){if(typeof this.options.resolveUrl!="function")return console.warn("[swup] options.resolveUrl expects a callback function."),i;const t=this.options.resolveUrl(i);return t&&typeof t=="string"?t.startsWith("//")||t.startsWith("http")?(console.warn("[swup] options.resolveUrl needs to return a relative url"),i):t:(console.warn("[swup] options.resolveUrl needs to return a url"),i)}function lt(i,t){return this.resolveUrl(i)===this.resolveUrl(t)}const ht={animateHistoryBrowsing:!1,animationSelector:'[class*="transition-"]',animationScope:"html",cache:!0,containers:["#swup"],ignoreVisit:(i,{el:t}={})=>!(t==null||!t.closest("[data-no-swup]")),linkSelector:"a[href]",linkToSelf:"scroll",plugins:[],resolveUrl:i=>i,requestHeaders:{"X-Requested-With":"swup",Accept:"text/html, application/xhtml+xml"},skipPopStateHandling:i=>{var t;return((t=i.state)==null?void 0:t.source)!=="swup"},timeout:0};class ct{constructor(t={}){var e,s;this.version="4.4.2",this.options=void 0,this.defaults=ht,this.plugins=[],this.visit=void 0,this.cache=void 0,this.hooks=void 0,this.classes=void 0,this.currentPageUrl=y(),this.currentHistoryIndex=void 0,this.clickDelegate=void 0,this.navigating=!1,this.use=nt,this.unuse=ot,this.findPlugin=rt,this.log=()=>{},this.navigate=Q,this.performNavigation=Y,this.createVisit=K,this.delegateEvent=_,this.fetchPage=j,this.awaitAnimations=X,this.renderPage=st,this.replaceContent=tt,this.animatePageIn=it,this.animatePageOut=Z,this.scrollToContent=et,this.getAnchorElement=J,this.getCurrentUrl=y,this.resolveUrl=at,this.isSameResolvedUrl=lt,this.options=d({},this.defaults,t),this.handleLinkClick=this.handleLinkClick.bind(this),this.handlePopState=this.handlePopState.bind(this),this.cache=new B(this),this.classes=new z(this),this.hooks=new G(this),this.visit=this.createVisit({to:""}),this.currentHistoryIndex=(e=(s=history.state)==null?void 0:s.index)!=null?e:1,this.checkRequirements()&&this.enable()}checkRequirements(){return typeof Promise<"u"||(console.warn("Promise is not supported"),!1)}async enable(){var t;const{linkSelector:e}=this.options;this.clickDelegate=this.delegateEvent(e,"click",this.handleLinkClick),window.addEventListener("popstate",this.handlePopState),this.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),this.options.plugins.forEach(s=>this.use(s)),((t=history.state)==null?void 0:t.source)!=="swup"&&S(null,{index:this.currentHistoryIndex}),await M(),await this.hooks.call("enable",void 0,()=>{document.documentElement.classList.add("swup-enabled")})}async destroy(){this.clickDelegate.destroy(),window.removeEventListener("popstate",this.handlePopState),this.cache.clear(),this.options.plugins.forEach(t=>this.unuse(t)),await this.hooks.call("disable",void 0,()=>{document.documentElement.classList.remove("swup-enabled")}),this.hooks.clear()}shouldIgnoreVisit(t,{el:e,event:s}={}){const{origin:n,url:o,hash:l}=w.fromUrl(t);return n!==window.location.origin||!(!e||!this.triggerWillOpenNewWindow(e))||!!this.options.ignoreVisit(o+l,{el:e,event:s})}handleLinkClick(t){const e=t.delegateTarget,{href:s,url:n,hash:o}=w.fromElement(e);this.shouldIgnoreVisit(s,{el:e,event:t})||(this.navigating&&n===this.visit.to.url?t.preventDefault():(this.visit=this.createVisit({to:n,hash:o,el:e,event:t}),t.metaKey||t.ctrlKey||t.shiftKey||t.altKey?this.hooks.call("link:newtab",{href:s}):t.button===0&&this.hooks.callSync("link:click",{el:e,event:t},()=>{var l;const r=(l=this.visit.from.url)!=null?l:"";t.preventDefault(),n&&n!==r?this.isSameResolvedUrl(n,r)||this.performNavigation():o?this.hooks.callSync("link:anchor",{hash:o},()=>{S(n+o),this.scrollToContent()}):this.hooks.callSync("link:self",void 0,()=>this.options.linkToSelf==="navigate"?this.performNavigation():(S(n),this.scrollToContent()))})))}handlePopState(t){var e,s,n,o;const l=(e=(s=t.state)==null?void 0:s.url)!=null?e:location.href;if(this.options.skipPopStateHandling(t)||this.isSameResolvedUrl(y(),this.currentPageUrl))return;const{url:r,hash:a}=w.fromUrl(l);this.visit=this.createVisit({to:r,hash:a,event:t}),this.visit.history.popstate=!0;const h=(n=(o=t.state)==null?void 0:o.index)!=null?n:0;h&&h!==this.currentHistoryIndex&&(this.visit.history.direction=h-this.currentHistoryIndex>0?"forwards":"backwards",this.currentHistoryIndex=h),this.visit.animation.animate=!1,this.visit.scroll.reset=!1,this.visit.scroll.target=!1,this.options.animateHistoryBrowsing&&(this.visit.animation.animate=!0,this.visit.scroll.reset=!0),this.hooks.callSync("history:popstate",{event:t},()=>{this.performNavigation()})}triggerWillOpenNewWindow(t){return!!t.matches('[download], [target="_blank"]')}}const ut=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"}));export{ut as S,M as g,w as l,L as m,y as n};
