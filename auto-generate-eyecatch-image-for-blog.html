<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <link rel="preload" href="./fonts/fusion-pixel.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload prefetch" href="./global.css" as="style" />
    <link rel="stylesheet" href="./global.css" />
    <!-- <link rel="manifest" href="./manifest.json" /> -->
    <link rel="icon" type="image/png" href="./favicon.ico" />

    <!-- This contains the contents of the <svelte:head> component, if
	     the current page has one -->
    <meta http-equiv="content-security-policy" content=""><title>自動產生部落格預覽圖片</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-CRDP7WTXSQ" data-svelte="svelte-bhtlqr"></script><link rel="shortcut icon" href="/favicon.ico" data-svelte="svelte-1c8ynol"><link rel="bookmark" href="/favicon.ico" data-svelte="svelte-1c8ynol"><link rel="canonical" href="https://f6bfb5.github.io/auto-generate-eyecatch-image-for-blog" data-svelte="svelte-17ikmly"><meta property="og:url" content="https://f6bfb5.github.io/auto-generate-eyecatch-image-for-blog" data-svelte="svelte-17ikmly"><meta property="og:type" content="article" data-svelte="svelte-17ikmly">
    <meta property="og:title" content="自動產生部落格預覽圖片" data-svelte="svelte-17ikmly">
    

    
    <meta property="og:image" data-svelte="svelte-17ikmly">

    <meta name="twitter:card" content="summary_large_image" data-svelte="svelte-17ikmly">
    <meta name="twitter:title" value="自動產生部落格預覽圖片" data-svelte="svelte-17ikmly">
    
    <meta name="twitter:label1" value="Published on" data-svelte="svelte-17ikmly">
    <meta name="twitter:data1" value="Aug 26, 2021" data-svelte="svelte-17ikmly">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-0d892495.css">
	<link rel="stylesheet" href="/_app/assets/_post-5b55a3da.css">
	<link rel="stylesheet" href="/_app/assets/ACG-80s-winter-age-of-anime-c464cb87.css">
	<link rel="stylesheet" href="/_app/assets/login-with-discord-4c509c13.css">
	<link rel="stylesheet" href="/_app/assets/sticker-generator-a58d6bc5.css">
	<link rel="stylesheet" href="/_app/assets/tool-list-creativity-74747bfb.css">
	<link rel="stylesheet" href="/_app/assets/what-nft-is-not-17bf58b6.css">
	<link rel="modulepreload" href="/_app/start-31365860.js">
	<link rel="modulepreload" href="/_app/chunks/index-eaf72aad.js">
	<link rel="modulepreload" href="/_app/chunks/index-45113aeb.js">
	<link rel="modulepreload" href="/_app/chunks/paths-396f020f.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-441c857b.js">
	<link rel="modulepreload" href="/_app/pages/_slug_.svelte-06cbf435.js">
	<link rel="modulepreload" href="/_app/chunks/2020-what-i-have-read-on-internet-ff0502fe.js">
	<link rel="modulepreload" href="/_app/chunks/_post-b069be5f.js">
	<link rel="modulepreload" href="/_app/chunks/2021-what-i-have-read-on-internet-ba232f00.js">
	<link rel="modulepreload" href="/_app/chunks/2022-what-i-have-read-on-internet-3be158ac.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-80s-winter-age-of-anime-db8130d6.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-Pause-And-Select-Apocalypse-8ca72aa4.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-all-about-kaworu-ikuhara-kunihiko-interview-f2d04fc7.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-char-counterattack-fans-interview-492883c3.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-difference-of-director-and-producer-d9c047ab.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-does-anno-hideaki-really-dont-know-what-he-is-making-33b894cc.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-emotion-of-mother-00-4cb4e75e.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-emotion-of-mother-01-6dbe7eef.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-emotion-of-mother-02-9ecd1684.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-emotion-of-mother-03-4b46090c.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-eoe-interview-4f0f62f6.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-evening-chat-of-game-xenogears-b8cae358.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-expression-of-light-and-heavy-1eb2abbb.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-games-done-quick-introduction-e3f92d87.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-history-of-robot-anime-598ff6ed.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-linda-cube-introduction-cd3e9604.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-linda-cube-on-ps-archive-7d41bbdc.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-making-of-linda3-82c1d783.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-note-aef872e4.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-on-your-mark-0833b287.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-our-bible-just-reissue-in-kindle-33ac9741.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-paintaking-of-anime-buble-tragedy-of-musashi-gundoh-361cd6dd.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-planetes-is-the-treasure-of-life-75b698d0.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-rockman-1-tas-glitch-8c9a3d32.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-s3-project-bead503e.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-seino-tooru-9b0776b7.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-serial-experiments-lain-for-ps-7c7bed9a.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-super-manga-book-list-4599a34d.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-tenki-no-ko-is-sekaikei-also-not-ee01b689.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-the-influences-of-naoko-yamada-d390be23.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-the-way-of-quality-anubis-zone-of-enders-hd-edition-0602af76.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-thought-about-re-take-3578bb4c.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-understanding-staff-of-anime-55c3059b.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-why-you-should-not-use-interpolation-on-anime-dcbd7afb.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-would-netflix-be-the-saviour-of-anime-fd408b8d.js">
	<link rel="modulepreload" href="/_app/chunks/ACG-yume-no-shima-de-aimashou-261f31cf.js">
	<link rel="modulepreload" href="/_app/chunks/auto-generate-eyecatch-image-for-blog-54da7036.js">
	<link rel="modulepreload" href="/_app/chunks/blog-with-hexo-40548d47.js">
	<link rel="modulepreload" href="/_app/chunks/blog-with-svelte-196d3da2.js">
	<link rel="modulepreload" href="/_app/chunks/capitalist-realism-mark-fisher-d24f6aab.js">
	<link rel="modulepreload" href="/_app/chunks/how-do-you-like-wendesday-78bf5651.js">
	<link rel="modulepreload" href="/_app/chunks/how-to-check-font-family-name-in-computer-c685caf0.js">
	<link rel="modulepreload" href="/_app/chunks/login-with-discord-b791fc19.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-bump-of-chicken-guild-dccba6ad.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-bump-of-chicken-lostman-f7069845.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-buzy-venus-say-2a3aa4ac.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-eastern-youth-song-of-daybreak-09dc6dd5.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-gift-from-you-67fb82ac.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-good-night-world-efc5be4e.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-hamada-shogo-j-boy-0040c764.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-higuchi-ryouichi-1-6-dream-traveller-f812f8bf.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-joanne-hogg-stars-of-tears-4e9c2c11.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-long-long-ago-20th-century-d70ae65a.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-mr-children-fake-14766b3a.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-okui-aki-wind-climbing-254291bc.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-onitaba-chihiro-rollin-a078813a.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-onitaba-chihiro-waltz-with-me-07bcd3b3.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-psy-s-earth-ark-on-the-tree-de73d1c3.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-radwimps-grand-escape-78118f1e.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-saihate-2cad2dfd.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-saitou-kazuyoshi-star-over-the-sky-is-so-beautiful-81803dd0.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-sakai-mikio-wonderful-life-6f99eeea.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-sambomaster-people-call-it-passion-993b8873.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-see-saw-story-with-you-3117ae42.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-shounannokaze-kurenai-76aa03c4.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-susumu-hirasawa-kingdom-ad9bf7d5.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-suzuki-yume-one-and-only-0e61d08f.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-the-high-lows-messenger-from-sunday-869472d0.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-the-pillows-funny-bunny-bade7c84.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-toshihide-baba-boys-on-the-run-d7c4c6da.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-toshihide-baba-ordinary-a48d1b2f.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-yoshida-takuro-dont-talk-about-life-32279e46.js">
	<link rel="modulepreload" href="/_app/chunks/lyrics-yui-makino-modokashii-sekai-no-ue-de-0de6e8e0.js">
	<link rel="modulepreload" href="/_app/chunks/mpv-0337142d.js">
	<link rel="modulepreload" href="/_app/chunks/operating-with-keyboard-fc375296.js">
	<link rel="modulepreload" href="/_app/chunks/search-engine-operators-82403ecc.js">
	<link rel="modulepreload" href="/_app/chunks/sticker-generator-06a436e1.js">
	<link rel="modulepreload" href="/_app/chunks/template-b051d5df.js">
	<link rel="modulepreload" href="/_app/chunks/tool-list-creativity-e2d138af.js">
	<link rel="modulepreload" href="/_app/chunks/tool-list-gaming-69595780.js">
	<link rel="modulepreload" href="/_app/chunks/tool-list-system-1d8af2b7.js">
	<link rel="modulepreload" href="/_app/chunks/tool-list-website-5fec91eb.js">
	<link rel="modulepreload" href="/_app/chunks/use-foobar2k-to-listen-to-podcast-8a39696f.js">
	<link rel="modulepreload" href="/_app/chunks/what-nft-is-not-d901d747.js">
	<link rel="modulepreload" href="/_app/chunks/why-is-life-so-boring-6474d7d7.js">
  </head>
  <body>
    <!-- The application will be rendered inside this element,
	     because `app/client.js` references it -->
    








<div class="layout svelte-1d1gp95" style=""><div class="loader-container svelte-1d1gp95"><div class="loader svelte-v56dyc"><span class="loader-text loader-step1 svelte-v56dyc">/</span>
  <span class="loader-text loader-step1 svelte-v56dyc">-</span>
  <span class="loader-text loader-step1 svelte-v56dyc">\</span>
  <span class="loader-text loader-step1 svelte-v56dyc">|</span>
</div></div></div>

<div class="layout svelte-1d1gp95" style="display: none;">

  
  <header class="svelte-ka06mn"><div class="header-container svelte-ka06mn"><div class="row svelte-ka06mn"><nav class="svelte-t90z2a"><a class=" svelte-t90z2a" href="/">トリコじかけの明け暮れ
  </a>
  <a class=" svelte-t90z2a" href="/about">about
  </a>
  <a class=" svelte-t90z2a" href="/rss.xml">rss
  </a>
  <a href="/sitemap.xml" style="display: none;" class="svelte-t90z2a">sitemap</a>
</nav>
      <a href="https://www.nicovideo.jp/watch/sm38213757" target="_blank" rel="noreferrer noopener" class="svelte-1swke90"><img src="data:image/gif;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAABbl4Awr28AAAAAAC4pp4ACgUAAFomhAB4aGEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiQiQiIkREREREJCIiQRERERESIiJBEhEREREiIkFCQRFRESIiQRIRERFRIiJBEREREREiIkE2ZmZmESQiQWYAAAZhJCJBZgAABmEkIkFmAAAGYSQiQWYAAAZhRCJBZgAABmFEIkE2ZmZmMUQiQRERERERRCJERERERERCLABwAAgAMAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAwAA" alt="logo" style="width: 36px; height: 42px;">
</a></div>
    
<div id="progress-bar" style="--scrollAmount: 0%;" class="svelte-1gbseey"></div></div>
</header>

  <main class="svelte-1d1gp95">

<header class="svelte-100hyuq"><h1 class="title svelte-100hyuq"><span style="animation-delay: 125ms; " class="svelte-100hyuq">自
      </span><span style="animation-delay: 150ms; " class="svelte-100hyuq">動
      </span><span style="animation-delay: 175ms; " class="svelte-100hyuq">產
      </span><span style="animation-delay: 200ms; " class="svelte-100hyuq">生
      </span><span style="animation-delay: 225ms; " class="svelte-100hyuq">部
      </span><span style="animation-delay: 250ms; " class="svelte-100hyuq">落
      </span><span style="animation-delay: 275ms; " class="svelte-100hyuq">格
      </span><span style="animation-delay: 300ms; " class="svelte-100hyuq">預
      </span><span style="animation-delay: 325ms; " class="svelte-100hyuq">覽
      </span><span style="animation-delay: 350ms; " class="svelte-100hyuq">圖
      </span><span style="animation-delay: 375ms; " class="svelte-100hyuq">片
      </span></h1>
  <p class="meta svelte-100hyuq"><span class="date svelte-100hyuq">Aug 26, 2021</span>
    <div class="tags svelte-100hyuq"><span class="tag svelte-100hyuq">F2E</span></div></p></header>
<div class="post--container svelte-100hyuq"><article class="post--content svelte-100hyuq"><p>例如 <a href="https://qiita.com/" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/" alt="Qiita"><span>Qiita</span></a> 或 <a href="https://hatenablog.com/" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://hatenablog.com/" alt="Hatena Blog"><span>Hatena Blog</span></a>，現在許多網站都能在預覽時的縮圖上顯示對應文章的標題，而這實際上到底是怎麼做到的？</p>
<p>我很大幅度（或者說幾乎全部）參考了 <a href="https://shuheikagawa.com/blog/2019/10/13/generating-twitter-card-images/" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://shuheikagawa.com/blog/2019/10/13/generating-twitter-card-images/" alt="Generating Twitter Card images from blog post titles"><span>Generating Twitter Card images from blog post titles</span></a> 這篇文章的做法，使用 Node.js 的 canvas library <code>node-canvas</code> 直接在 canvas 上畫好預覽圖，存成檔案後，再設定好相關元素的對應檔案路徑，就能替網站文章加上預覽圖了。</p>
<h2>處理步驟</h2>
<h3>1. 取得文章資訊</h3>
<p>要產生圖片，首先得要有文章的標題或相關資訊，Sapper 的 Blog 樣板提供了一支 <a href="https://github.com/Charca/sapper-blog-template/blob/master/src/utils/markdown.js" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://github.com/Charca/sapper-blog-template/blob/master/src/utils/markdown.js" alt="markdown.js"><span>markdown.js</span></a> 處理前置的檔案匯入與 meta 資訊的產生，故只需再多加上縮圖用的 meta 資訊，並從此傳入相關資訊至生成 function 即可：</p>
<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// another utility JavaScript file, will be described after</span>
<span class="token keyword">const</span> createTitleImage <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/utils/title-image.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">md<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// markdown file content</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> rawContent <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">matter</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> title<span class="token punctuation">,</span> date <span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// image meta info placeholder</span>
    <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
    <span class="token comment">// if had set custom image then don't generate</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>image<span class="token punctuation">)</span> image <span class="token operator">=</span> data<span class="token punctuation">.</span>image<span class="token punctuation">;</span>
    <span class="token comment">// if not set custom image then generate it</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// generate canvas</span>
        <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createTitleImage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          title<span class="token punctuation">,</span>
          <span class="token literal-property property">subtitle</span><span class="token operator">:</span> <span class="token string">"f6bfb5.github.io"</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// save canvas to file</span>
        <span class="token keyword">const</span> imagePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"./static/preview/"</span><span class="token punctuation">,</span> slug <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token string">"./static/preview/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">"./static/preview/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// set image meta info</span>
        image <span class="token operator">=</span> <span class="token string">"https://f6bfb5.github.io/preview/"</span> <span class="token operator">+</span> slug <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// add image to meta info</span>
    <span class="token keyword">const</span> exportFromModule <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> title <span class="token operator">||</span> slug<span class="token punctuation">,</span>
      slug<span class="token punctuation">,</span>
      html<span class="token punctuation">,</span>
      date<span class="token punctuation">,</span>
      excerpt<span class="token punctuation">,</span>
      printDate<span class="token punctuation">,</span>
      printReadingTime<span class="token punctuation">,</span>
      tags<span class="token punctuation">,</span>
      image<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<h3>2. 產生圖片</h3>
<p>上方提及的文章作者也提供了自己的程式碼 <a href="https://github.com/shuhei/shuhei.github.com/blob/f30cb5cd85a4ef35a4fb73d94a01da44e03ae116/plugins/title-image.js" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://github.com/shuhei/shuhei.github.com/blob/f30cb5cd85a4ef35a4fb73d94a01da44e03ae116/plugins/title-image.js" alt="title-image.js"><span>title-image.js</span></a>，非常感激地只更改了裡頭的字體後完全借用，使用前也需注意是否已安裝 <code>node-canvas</code>，若無則需先 <code>npm i canvas</code>。</p>
<h3>3. 存為檔案</h3>
<p><code>title-image.js</code> 回傳的是 Buffer object，因此需要再使用 <code>fs</code> 存為檔案，這部分的程式碼也已寫在第 1 步 <code>else</code> 的部分裡，這邊傳入文章別名作為檔案名稱，並檢查目標資料夾是否存在﹐若是如遠端推播環境則另行產生，最後使用 <code>writeFileSync</code> 存入檔案。</p>
<h3>4. 設定 meta tag</h3>
<p>有了圖片檔案後，就能將路徑傳進文章樣板裡的對應 meta 裡，同樣的，Sapper 的 <a href="https://github.com/Charca/sapper-blog-template/blob/master/src/routes/blog/%5Bslug%5D.svelte" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://github.com/Charca/sapper-blog-template/blob/master/src/routes/blog/%5Bslug%5D.svelte" alt="Blog 文章樣板"><span>Blog 文章樣板</span></a>也附上了社群網站用的 meta tag，只需加入第 1 步新增的縮圖 meta 資訊即可。</p>
<pre class="language-html"><!-- HTML_TAG_START --><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">preload</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> params<span class="token punctuation">,</span> query <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// will get data and meta info from markdown files</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>slug<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.json</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">post</span><span class="token operator">:</span> data <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- ... --></span>
<span class="token comment">&lt;!-- add image meta info --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>og:image<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;post.image&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><!-- HTML_TAG_END --></pre>
<p>完成！</p>
<h2>改善點</h2>
<p>雖然看來原本也有考慮到日文標題的情況，目前看來一些太長的標題還是會全縮在同一行導致字變得太小，發生文字無法妥善分行的狀況，也有像這篇另外使用了文字型態分析 library 解決這個問題，以及整體的配色或配置考量，都是日後首要的改善點。</p>
    <span class="blink svelte-1kip24n">_</span></article>
  

<div class="back-to-top svelte-1p7rwza hidden" style="right: 2em">Back to top
</div>
</div></main>

  <footer scoped class="svelte-1xo47ws"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer noopener nofollow">CC BY-NC-SA 4.0
  </a>
  <div class="right svelte-1xo47ws">Made with <span class="heart svelte-1xo47ws">❤️</span> and
    <a href="https://kit.svelte.dev/" target="_blank" ref="noreferrer noopener nofollow">SvelteKit
    </a></div>
  <div class="clearfix svelte-1xo47ws"></div>
</footer>
</div>


		<script type="module" data-hydrate="19bcsns">
		import { start } from "/_app/start-31365860.js";
		start({
			target: document.querySelector('[data-hydrate="19bcsns"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-441c857b.js"),
						import("/_app/pages/_slug_.svelte-06cbf435.js")
				],
				params: {slug:"auto-generate-eyecatch-image-for-blog"},
				routeId: "[slug]"
			}
		});
	</script>
  </body>
</html>
