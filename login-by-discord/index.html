<!DOCTYPE html> <html lang=zh-Hant-TW> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/ > <link href=global.css rel=stylesheet> <link href=fonts.css rel=stylesheet> <link href=highlight.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.png rel=icon type=image/png> <link href=client/client-6438aab0.css rel=stylesheet><link href=client/[slug]-be2f2fa9.css rel=stylesheet> <title>實作「使用 Discord 登入」</title><script async data-svelte=svelte-a2kvt3 src="https://www.googletagmanager.com/gtag/js?id=UA-114661136-2"></script><script async data-svelte=svelte-1op50db src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js data-ad-client=ca-pub-9613661448556355></script><link href=/apple-touch-icon.png rel=apple-touch-icon data-svelte=svelte-12mb5ri sizes=180x180><link href=/favicon-32x32.png rel=icon data-svelte=svelte-12mb5ri sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon data-svelte=svelte-12mb5ri sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest data-svelte=svelte-12mb5ri><link href=/safari-pinned-tab.svg rel=mask-icon data-svelte=svelte-12mb5ri color=#5bbad5><meta data-svelte=svelte-12mb5ri name=msapplication-TileColor content=#ffc40d><meta data-svelte=svelte-12mb5ri name=theme-color content=#ffffff><meta data-svelte=svelte-d2s233 content=article property=og:type><meta data-svelte=svelte-d2s233 content="實作「使用 Discord 登入」" property=og:title><meta data-svelte=svelte-d2s233 name=Description><meta data-svelte=svelte-d2s233 property=og:description><meta data-svelte=svelte-d2s233 name=twitter:card content=summary_large_image><meta data-svelte=svelte-d2s233 name=twitter:title value="實作「使用 Discord 登入」"><meta data-svelte=svelte-d2s233 name=twitter:description><meta data-svelte=svelte-d2s233 name=twitter:label1 value="Published on"><meta data-svelte=svelte-d2s233 name=twitter:data1 value="Jan 14, 2021"> <link href=/client/client.61af1bd8.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-6438aab0.css rel=preload as=style><link href=/client/[slug].60004b99.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-be2f2fa9.css rel=preload as=style></head> <body> <div id=sapper> <div class="svelte-wjh32h layout"> <header class=svelte-310tmg><nav class=svelte-1c2nkmp><a href=. class=svelte-1c2nkmp>blog</a> <a href=about class=svelte-1c2nkmp>about</a> <a href=rss.xml class=svelte-1c2nkmp>rss</a> </nav> <a href=/ ><img alt="Buddha of Kamakura" class=svelte-nsstmh src=noun_great_buddha_of_kamakura_3572172.svg> </a> </header> <main class=svelte-wjh32h> <header class=svelte-7rau0t><h1 class=svelte-7rau0t>實作「使用 Discord 登入」</h1> <p class=svelte-7rau0t>January 14, 2021</header> <div class=container><article class=content><ul> <li><a href=https://qiita.com/masayoshi4649/items/46fdb744cb8255f5eb98#token%E3%81%A8%E5%85%B1%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%83%A6%E3%83%BC%E3%82%B6%E6%83%85%E5%A0%B1%E3%82%92%E5%BE%97%E3%82%8B rel=nofollow target=_blank>「Discord の ID でログイン」を実装する(Oauth2) - Qiita</a></li> </ul> <h2 id=於-discord-developer-portal-登錄-application>於 Discord Developer Portal 登錄 Application</h2> <h3 id=取得-「client-id」和「client-secert」>取得 「Client ID」和「Client Secert」</h3> <ol> <li>登入 <a href=https://discord.com/developers/applications rel=nofollow target=_blank>Discord Developer Portal</a></li> <li>點擊右上角的「New Application」</li> <li>取名，本例使用 <code>OAuth Vertify</code>，點擊「Create」</li> <li><code>Client ID</code> 和 <code>Client Secert</code> 位於資訊頁的右方</li> </ol> <h3 id=建立-oauth-用的網址>建立 OAuth 用的網址</h3> <ol> <li>點擊左側的「OAuth2」</li> <li>點擊右側的「Add Redirect」，輸入驗證登入用的網址</li> <li>勾選下方「SCOPE」（索取的資訊欄位）裡的「identify」（Discord 的 ID）和「email」</li> <li>就可取得認證用的連結 <code>https://discord.com/api/oauth2/authorize?client_id=</code>CLIENT ID<code>&redirect_uri=</code>REDIRECT URL<code>&response_type=code&scope=</code>SCOPE</li> </ol> <h2 id=於認證連結取得「code」>於認證連結取得「Code」</h2> <ol> <li>於認證連結登入後，會回傳一個 <code>code</code> 參數到網址上</li> </ol> <h2 id=將「code」轉換成「token」>將「Code」轉換成「Token」</h2> <ol> <li>傳送 POST 請求到 Discord API<blockquote> <p><code>curl -X POST -H "Content-Type:application/x-www-form-urlencoded" -d "client_id=</code>CLIENT ID<code>&client_secret=</code>CLIENT SECRET<code>&grant_type=authorization_code&code=</code>CODE<code>&redirect_uri=</code>REDIRECT URL(要與認證 URL 相同)<code>" https://discordapp.com/api/oauth2/token</code></p> </blockquote> </li> <li>若成功就可取得 Access Token<blockquote> <p><code>{"access_token": </code>ACCESS TOKEN<code>, "expires_in": 604800, "refresh_token": </code>REFRESH TOKEN<code>, "scope": </code>SCOPE<code>, "token_type": "Bearer"}</code></p> </blockquote> </li> </ol> <ul> <li>Code 為一次性使用，同一個 code 無法存取第二次</li> <li>Access Token 的有效期限為 604800 秒＝一個禮拜，若有更新需求須使用 REFRESH TOKEN 重新請求</li> </ul> <h2 id=使用「token」取得使用者資料>使用「Token」取得使用者資料</h2> <ol> <li>傳送 POST 請求到 Discord API <br><code>curl -H "Authorization: Bearer </code>ACCESS TOKEN<code>" https://discordapp.com/api/users/@me</code></li> <li>若成功就可取得相關資料<blockquote> <p><code>{"id": </code>Discord ID<code>, "username": </code>使用者名稱<code>, "avatar": </code>大頭貼 ID<code>, "discriminator": </code>使用者編號(在名稱#後面的數字)<code>, "public_flags": 0, "flags": 0, "email": </code>信箱<code>, "verified": true, "locale": </code>使用語言<code>, "mfa_enabled": false}</code></p> </blockquote> </li> </ol> <ul> <li>頭像可以使用 <code>https://cdn.discordapp.com/avatars/</code>Discord ID<code>/</code>大頭貼 ID 取得</li> </ul> <h2 id=使用-refresh-token-重新取得-access-token>使用 REFRESH TOKEN 重新取得 ACCESS TOKEN</h2> <ol> <li>傳送 POST 請求到 Discord API<blockquote> <p><code>curl -X POST -H "Content-Type:application/x-www-form-urlencoded" -d "client_id=</code>CLIENT ID<code>&client_secret=</code>CLIENT SECRET<code>&grant_type=refresh_token&refresh_token=</code>REFRESH TOKEN<code>" https://discordapp.com/api/oauth2/token</code></p> </blockquote> </li> <li>若成功就可取得 Access Token<blockquote> <p><code>{"access_token": </code>ACCESS TOKEN<code>, "expires_in": 604800, "refresh_token": </code>REFRESH TOKEN<code>, "scope": </code>SCOPE<code>, "token_type": "Bearer"}</code></p> </blockquote> </li> </ol> </article> </div></main> <footer class=svelte-wjh32h><span><a href=https://creativecommons.org/licenses/by-sa/4.0/ rel="noreferrer noopener nofollow" target=_blank>CC BY-SA 4.0.</a></span></footer> </div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{post:{title:"實作「使用 Discord 登入」",slug:"login-by-discord",html:"\u003Cul\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fqiita.com\u002Fmasayoshi4649\u002Fitems\u002F46fdb744cb8255f5eb98#token%E3%81%A8%E5%85%B1%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%83%A6%E3%83%BC%E3%82%B6%E6%83%85%E5%A0%B1%E3%82%92%E5%BE%97%E3%82%8B\"\u003E「Discord の ID でログイン」を実装する(Oauth2) - Qiita\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"於-discord-developer-portal-登錄-application\"\u003E於 Discord Developer Portal 登錄 Application\u003C\u002Fh2\u003E\n\u003Ch3 id=\"取得-「client-id」和「client-secert」\"\u003E取得 「Client ID」和「Client Secert」\u003C\u002Fh3\u003E\n\u003Col\u003E\n\u003Cli\u003E登入 \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fdiscord.com\u002Fdevelopers\u002Fapplications\"\u003EDiscord Developer Portal\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E點擊右上角的「New Application」\u003C\u002Fli\u003E\n\u003Cli\u003E取名，本例使用 \u003Ccode\u003EOAuth Vertify\u003C\u002Fcode\u003E，點擊「Create」\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003EClient ID\u003C\u002Fcode\u003E 和 \u003Ccode\u003EClient Secert\u003C\u002Fcode\u003E 位於資訊頁的右方\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch3 id=\"建立-oauth-用的網址\"\u003E建立 OAuth 用的網址\u003C\u002Fh3\u003E\n\u003Col\u003E\n\u003Cli\u003E點擊左側的「OAuth2」\u003C\u002Fli\u003E\n\u003Cli\u003E點擊右側的「Add Redirect」，輸入驗證登入用的網址\u003C\u002Fli\u003E\n\u003Cli\u003E勾選下方「SCOPE」（索取的資訊欄位）裡的「identify」（Discord 的 ID）和「email」\u003C\u002Fli\u003E\n\u003Cli\u003E就可取得認證用的連結 \u003Ccode\u003Ehttps:\u002F\u002Fdiscord.com\u002Fapi\u002Foauth2\u002Fauthorize?client_id=\u003C\u002Fcode\u003ECLIENT ID\u003Ccode\u003E&amp;redirect_uri=\u003C\u002Fcode\u003EREDIRECT URL\u003Ccode\u003E&amp;response_type=code&amp;scope=\u003C\u002Fcode\u003ESCOPE\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2 id=\"於認證連結取得「code」\"\u003E於認證連結取得「Code」\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E於認證連結登入後，會回傳一個 \u003Ccode\u003Ecode\u003C\u002Fcode\u003E 參數到網址上\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2 id=\"將「code」轉換成「token」\"\u003E將「Code」轉換成「Token」\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E傳送 POST 請求到 Discord API\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003Ecurl -X POST -H &quot;Content-Type:application\u002Fx-www-form-urlencoded&quot; -d &quot;client_id=\u003C\u002Fcode\u003ECLIENT ID\u003Ccode\u003E&amp;client_secret=\u003C\u002Fcode\u003ECLIENT SECRET\u003Ccode\u003E&amp;grant_type=authorization_code&amp;code=\u003C\u002Fcode\u003ECODE\u003Ccode\u003E&amp;redirect_uri=\u003C\u002Fcode\u003EREDIRECT URL(要與認證 URL 相同)\u003Ccode\u003E&quot; https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Foauth2\u002Ftoken\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E若成功就可取得 Access Token\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003E{&quot;access_token&quot;: \u003C\u002Fcode\u003EACCESS TOKEN\u003Ccode\u003E, &quot;expires_in&quot;: 604800, &quot;refresh_token&quot;: \u003C\u002Fcode\u003EREFRESH TOKEN\u003Ccode\u003E, &quot;scope&quot;: \u003C\u002Fcode\u003ESCOPE\u003Ccode\u003E, &quot;token_type&quot;: &quot;Bearer&quot;}\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cul\u003E\n\u003Cli\u003ECode 為一次性使用，同一個 code 無法存取第二次\u003C\u002Fli\u003E\n\u003Cli\u003EAccess Token 的有效期限為 604800 秒＝一個禮拜，若有更新需求須使用 REFRESH TOKEN 重新請求\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"使用「token」取得使用者資料\"\u003E使用「Token」取得使用者資料\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E傳送 POST 請求到 Discord API\n\u003Cbr\u003E\u003Ccode\u003Ecurl -H &quot;Authorization: Bearer \u003C\u002Fcode\u003EACCESS TOKEN\u003Ccode\u003E&quot; https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Fusers\u002F@me\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E若成功就可取得相關資料\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003E{&quot;id&quot;: \u003C\u002Fcode\u003EDiscord ID\u003Ccode\u003E, &quot;username&quot;: \u003C\u002Fcode\u003E使用者名稱\u003Ccode\u003E, &quot;avatar&quot;: \u003C\u002Fcode\u003E大頭貼 ID\u003Ccode\u003E, &quot;discriminator&quot;: \u003C\u002Fcode\u003E使用者編號(在名稱#後面的數字)\u003Ccode\u003E, &quot;public_flags&quot;: 0, &quot;flags&quot;: 0, &quot;email&quot;: \u003C\u002Fcode\u003E信箱\u003Ccode\u003E, &quot;verified&quot;: true, &quot;locale&quot;: \u003C\u002Fcode\u003E使用語言\u003Ccode\u003E, &quot;mfa_enabled&quot;: false}\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cul\u003E\n\u003Cli\u003E頭像可以使用 \u003Ccode\u003Ehttps:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F\u003C\u002Fcode\u003EDiscord ID\u003Ccode\u003E\u002F\u003C\u002Fcode\u003E大頭貼 ID 取得\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"使用-refresh-token-重新取得-access-token\"\u003E使用 REFRESH TOKEN 重新取得 ACCESS TOKEN\u003C\u002Fh2\u003E\n\u003Col\u003E\n\u003Cli\u003E傳送 POST 請求到 Discord API\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003Ecurl -X POST -H &quot;Content-Type:application\u002Fx-www-form-urlencoded&quot; -d &quot;client_id=\u003C\u002Fcode\u003ECLIENT ID\u003Ccode\u003E&amp;client_secret=\u003C\u002Fcode\u003ECLIENT SECRET\u003Ccode\u003E&amp;grant_type=refresh_token&amp;refresh_token=\u003C\u002Fcode\u003EREFRESH TOKEN\u003Ccode\u003E&quot; https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Foauth2\u002Ftoken\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003E若成功就可取得 Access Token\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003E{&quot;access_token&quot;: \u003C\u002Fcode\u003EACCESS TOKEN\u003Ccode\u003E, &quot;expires_in&quot;: 604800, &quot;refresh_token&quot;: \u003C\u002Fcode\u003EREFRESH TOKEN\u003Ccode\u003E, &quot;scope&quot;: \u003C\u002Fcode\u003ESCOPE\u003Ccode\u003E, &quot;token_type&quot;: &quot;Bearer&quot;}\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n",date:"2021-01-14T00:24:23.000Z",printDate:"January 14, 2021",printReadingTime:"2 min read"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.61af1bd8.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main","/client/client.61af1bd8.js")}document.head.appendChild(s)</script> 