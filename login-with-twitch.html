<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <link
      rel="preload"
      href="./fonts/fusion-pixel.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="preload prefetch" href="./global.css" as="style" />
    <link rel="stylesheet" href="./global.css" />
    <!-- <link rel="manifest" href="./manifest.json" /> -->
    <link rel="icon" type="image/png" href="./favicon.ico" />

    <!-- This contains the contents of the <svelte:head> component, if
	     the current page has one -->
    <meta http-equiv="content-security-policy" content=""><title>實作「使用Twitch登入」</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-CRDP7WTXSQ" data-svelte="svelte-bhtlqr"></script><link rel="shortcut icon" href="/favicon.ico" data-svelte="svelte-1c8ynol"><link rel="bookmark" href="/favicon.ico" data-svelte="svelte-1c8ynol"><link rel="canonical" href="https://f6bfb5.github.io/login-with-twitch" data-svelte="svelte-1xtzxhc"><meta property="og:url" content="https://f6bfb5.github.io/login-with-twitch" data-svelte="svelte-1xtzxhc"><meta property="og:type" content="article" data-svelte="svelte-1xtzxhc">
    <meta property="og:title" content="實作「使用Twitch登入」" data-svelte="svelte-1xtzxhc">
    

    
    <meta property="og:image" data-svelte="svelte-1xtzxhc">

    <meta name="twitter:card" content="summary_large_image" data-svelte="svelte-1xtzxhc">
    <meta name="twitter:title" value="實作「使用Twitch登入」" data-svelte="svelte-1xtzxhc">
    
    <meta name="twitter:label1" value="Published on" data-svelte="svelte-1xtzxhc">
    <meta name="twitter:data1" value="May 2, 2023" data-svelte="svelte-1xtzxhc">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-193c0755.css">
	<link rel="stylesheet" href="/_app/assets/Favicon-3192f126.css">
	<link rel="modulepreload" href="/_app/start-846d4d8f.js">
	<link rel="modulepreload" href="/_app/chunks/index-8418cccc.js">
	<link rel="modulepreload" href="/_app/chunks/index-17c965c3.js">
	<link rel="modulepreload" href="/_app/chunks/paths-396f020f.js">
	<link rel="modulepreload" href="/_app/chunks/preload-helper-e4860ae8.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-95e80c0e.js">
	<link rel="modulepreload" href="/_app/chunks/Favicon-0f8e3455.js">
	<link rel="modulepreload" href="/_app/chunks/store-ad3b6131.js">
	<link rel="modulepreload" href="/_app/pages/_slug_.svelte-24cbf29c.js">
  </head>
  <body>
    <!-- The application will be rendered inside this element,
	     because `app/client.js` references it -->
    








<div class="layout svelte-1avnl50" style=""><div class="loader-container svelte-1avnl50"><div class="loader svelte-v56dyc"><span class="loader-text loader-step1 svelte-v56dyc">/</span>
  <span class="loader-text loader-step1 svelte-v56dyc">-</span>
  <span class="loader-text loader-step1 svelte-v56dyc">\</span>
  <span class="loader-text loader-step1 svelte-v56dyc">|</span>
</div></div></div>

<div class="layout svelte-1avnl50" style="display: none;">
  
  <header class="svelte-3mmsgf"><div class="header-container svelte-3mmsgf"><div class="row svelte-3mmsgf"><nav class="svelte-t90z2a"><a class=" svelte-t90z2a" href="/">トリコじかけの明け暮れ
  </a>
  <a class=" svelte-t90z2a" href="/about">about
  </a>
  <a class=" svelte-t90z2a" href="/rss.xml" target="_blank">rss
  </a>
  <a style="display: none;" href="/sitemap.xml" target="_blank" class="svelte-t90z2a">sitemap
  </a>
</nav>
      <a href="https://www.youtube.com/watch?v=uOREjHyENtc" target="_blank" rel="noreferrer noopener" class="svelte-145ut21"><img src="https://i.imgur.com/D0PAWCi.gif" alt="logo" class="svelte-145ut21">
</a></div>
    </div>
</header>

  <main class="svelte-1avnl50">

<header class="svelte-1y1bvug"><h1 class="title svelte-1y1bvug"><span style="animation-delay: 125ms; " class="svelte-1y1bvug">實
      </span><span style="animation-delay: 150ms; " class="svelte-1y1bvug">作
      </span><span style="animation-delay: 175ms; " class="svelte-1y1bvug">「
      </span><span style="animation-delay: 200ms; " class="svelte-1y1bvug">使
      </span><span style="animation-delay: 225ms; " class="svelte-1y1bvug">用
      </span><span style="animation-delay: 250ms; " class="svelte-1y1bvug">T
      </span><span style="animation-delay: 275ms; " class="svelte-1y1bvug">w
      </span><span style="animation-delay: 300ms; " class="svelte-1y1bvug">i
      </span><span style="animation-delay: 325ms; " class="svelte-1y1bvug">t
      </span><span style="animation-delay: 350ms; " class="svelte-1y1bvug">c
      </span><span style="animation-delay: 375ms; " class="svelte-1y1bvug">h
      </span><span style="animation-delay: 400ms; " class="svelte-1y1bvug">登
      </span><span style="animation-delay: 425ms; " class="svelte-1y1bvug">入
      </span><span style="animation-delay: 450ms; " class="svelte-1y1bvug">」
      </span></h1>
  <p class="meta svelte-1y1bvug"><span class="date svelte-1y1bvug">May 2, 2023</span>
    <div class="tags svelte-1y1bvug"><span class="tag svelte-1y1bvug">F2E</span></div></p></header>
<div class="post--container svelte-1y1bvug"><article class="post--content svelte-1y1bvug"><h2 id="js-id-1-於-twitch-developers-console-登錄應用">1. 於 Twitch developers console 登錄應用</h2>
<ol><li>登入 <a href="https://dev.twitch.tv/console/apps" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://dev.twitch.tv/console/apps" alt="Twitch Developers"><span>Twitch Developers</span></a></li>
<li>「Register Your Application」</li>
<li>取名，本文範例取為「OAuth Verify」<ul><li>此名稱會顯示於授權頁面上</li>
<li>以及輸入驗證完後重導向的網址<ul><li>也就是要用於驗證登入的網址</li>
<li>本文實作範例的網址就是此頁面連結：<ul><li><code>https://f6bfb5.github.io/login-with-twitch</code></li></ul></li></ul></li>
<li>「Create」</li></ul></li>
<li>「Manage」取得 <code>Client ID</code>，之後會用到</li></ol>
<h2 id="js-id-2-進行認證取得-access-token">2. 進行認證取得 access token</h2>
<ul><li>Twitch API 分有兩種 access token<ul><li>User access tokens<ul><li>用於需要使用者授權才能存取的資源</li>
<li>例如取得聊天室使用者清單、使用者的信箱</li></ul></li>
<li>App access tokens<ul><li>用於不需要使用者授權就能取得的資源</li>
<li>例如取得使用者的影片一覽</li></ul></li>
<li>其中 User access tokens 有兩種授權認證方式可取得<ul><li>Implicit grant flow<ul><li>用於不需要伺服器的應用</li></ul></li>
<li>Authorization code grant flow<ul><li>用於需要伺服器的應用</li>
<li>可以儲存 client secret，以及傳送伺服器請求</li></ul></li>
<li>並各提供兩種認證機制<ul><li>OAuth</li>
<li>OpenID Connect<ul><li>基於 OAuth 2.0 的簡易認證層</li>
<li>會另有一個以 JSON Web Token 編碼身份令牌的 ID token</li></ul></li></ul></li></ul></li>
<li>App access tokens 則是透過 OAuth Client Credentials Flow 取得<ul><li>詳細可參照 <a href="https://dev.twitch.tv/docs/authentication/#user-access-tokens" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://dev.twitch.tv/docs/authentication/#user-access-tokens" alt="Authentication"><span>Authentication</span></a></li></ul></li></ul></li>
<li>以 OAuth Implicit Code Flow 為範例</li></ul>
<ol><li>建立 OAuth 用的網址<ul><li><code>https://id.twitch.tv/oauth2/authorize?response_type=token&amp;client_id=</code>[CLIENT ID]<code>&amp;redirect_uri=</code>[REDIRECT URL]<code>&amp;scope=</code>[SCOPE]</li>
<li>Client ID<ul><li>於第一步取得</li></ul></li>
<li>Redirect URL<ul><li>重導向網址</li>
<li>本文範例以此頁面作為連結</li></ul></li>
<li>Scope<ul><li>要取得的授權內容</li>
<li><a href="https://dev.twitch.tv/docs/authentication/scopes/#twitch-api-scopes" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://dev.twitch.tv/docs/authentication/scopes/#twitch-api-scopes" alt="Twitch Access Token Scopes"><span>Twitch Access Token Scopes</span></a></li></ul></li></ul></li>
<li>驗證之後取得 access token<ul><li>Implicit grant flow 會將 access token 回傳到網址上<ul><li>JavaScript 可使用 <code>document.location.hash</code> 取得</li></ul></li></ul></li></ol>
<h2 id="js-id-3-使用-access-token-取得使用者資料">3. 使用 access token 取得使用者資料</h2>
<ul><li>使用 access token 即可取得使用者資料<ul><li><a href="https://dev.twitch.tv/docs/api/reference/#get-users" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://dev.twitch.tv/docs/api/reference/#get-users" alt="Get Users"><span>Get Users</span></a></li>
<li><pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript"><span class="token keyword">const</span> userApiUrl <span class="token operator">=</span> <span class="token string">"https://api.twitch.tv/helix/users"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> urlParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> resultData <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span>userApiUrl<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 從網址取得重導向回傳的 access token</span>
    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> urlParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"#access_token"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Client-Id"</span><span class="token operator">:</span> clientID<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"js-twitch-card"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span>
      <span class="token comment">// 資料會位於回傳的 data 屬性裡</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
        <span class="token string">"js-twitch-card--image"</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>r<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>profile_image_url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
        <span class="token string">"js-twitch-card--username"</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>r<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>login<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>r<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>display_name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre></li></ul></li>
<li>API 一覽：<a href="https://dev.twitch.tv/docs/api/reference/" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://dev.twitch.tv/docs/api/reference/" alt="Reference"><span>Reference</span></a></li></ul>
<h2 id="js-id-範例">範例</h2>
<button id="js-twitch-button">Login with Twitch</button>
<span id="js-twitch-status"></span>
<div class="twitch-card" id="js-twitch-card" style="display: none"><img alt="profile" class="twitch-card--image svelte-17600ve" id="js-twitch-card--image">
  <div class="twitch-card--username" id="js-twitch-card--username"></div></div>
<div class="toc-container"><ul class="toc"><li><a href="#" onclick="document.querySelector('#js-id-1-於-twitch-developers-console-登錄應用').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">1. 於 Twitch developers console 登錄應用</a></li><li><a href="#" onclick="document.querySelector('#js-id-2-進行認證取得-access-token').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">2. 進行認證取得 access token</a></li><li><a href="#" onclick="document.querySelector('#js-id-3-使用-access-token-取得使用者資料').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">3. 使用 access token 取得使用者資料</a></li><li><a href="#" onclick="document.querySelector('#js-id-範例').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">範例</a></li></ul></div>
    <span class="blink svelte-1kip24n">_</span></article>
  

<div class="back-to-top svelte-178usko hidden" style="right: 2em">Back to top
</div>
</div></main>

  <footer scoped class="svelte-qi6xiu"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer noopener nofollow">CC BY-NC-SA 4.0
  </a>
  <div class="right svelte-qi6xiu">Made with <span class="heart svelte-qi6xiu">❤️</span> and
    <a href="https://kit.svelte.dev/" target="_blank" ref="noreferrer noopener nofollow">SvelteKit
    </a></div>
</footer>
</div>


		<script type="module" data-hydrate="10xdvns">
		import { start } from "/_app/start-846d4d8f.js";
		start({
			target: document.querySelector('[data-hydrate="10xdvns"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: false,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-95e80c0e.js"),
						import("/_app/pages/_slug_.svelte-24cbf29c.js")
				],
				params: {slug:"login-with-twitch"},
				routeId: "[slug]"
			}
		});
	</script>
  </body>
</html>
