<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />

    <link rel="preload" href="../fonts/fusion-pixel.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload prefetch" href="../global.css" as="style" />
    <link rel="stylesheet" href="../global.css" />
    <!-- <link rel="manifest" href="../manifest.json" /> -->
    <link rel="icon" type="image/png" href="../favicon.ico" />

    <!-- This contains the contents of the <svelte:head> component, if
	     the current page has one -->
    <meta http-equiv="content-security-policy" content=""><script async src="https://www.googletagmanager.com/gtag/js?id=G-CRDP7WTXSQ" data-svelte="svelte-bhtlqr"></script><link rel="shortcut icon" href="/favicon.ico" data-svelte="svelte-1c8ynol"><link rel="bookmark" href="/favicon.ico" data-svelte="svelte-1c8ynol">
	<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-e04a8a3c.css">
	<link rel="stylesheet" href="/_app/assets/_post-6cf996f4.css">
	<link rel="stylesheet" href="/_app/assets/BlinkAnchor-39834c8c.css">
	<link rel="modulepreload" href="/_app/start-733206bd.js">
	<link rel="modulepreload" href="/_app/chunks/index-1cb0a915.js">
	<link rel="modulepreload" href="/_app/chunks/index-908f6326.js">
	<link rel="modulepreload" href="/_app/chunks/paths-396f020f.js">
	<link rel="modulepreload" href="/_app/pages/__layout.svelte-5611d17c.js">
	<link rel="modulepreload" href="/_app/pages/posts/use-google-spreadsheet-as-database.md-a930d868.js">
	<link rel="modulepreload" href="/_app/chunks/_post-8b5fe991.js">
	<link rel="modulepreload" href="/_app/chunks/BlinkAnchor-55bdbd1c.js">
	<link rel="modulepreload" href="/_app/chunks/use-google-spreadsheet-as-database-1c21b20b.js">
  </head>
  <body>
    <!-- The application will be rendered inside this element,
	     because `app/client.js` references it -->
    








<div class="layout svelte-1brf9ih" style=""><div class="loader-container svelte-1brf9ih"><div class="loader svelte-v56dyc"><span class="loader-text loader-step1 svelte-v56dyc">/</span>
  <span class="loader-text loader-step1 svelte-v56dyc">-</span>
  <span class="loader-text loader-step1 svelte-v56dyc">\</span>
  <span class="loader-text loader-step1 svelte-v56dyc">|</span>
</div></div></div>

<div class="layout svelte-1brf9ih" style="display: none;">

  
  <header class="svelte-ka06mn"><div class="header-container svelte-ka06mn"><div class="row svelte-ka06mn"><nav class="svelte-t90z2a"><a class=" svelte-t90z2a" href="/">トリコじかけの明け暮れ
  </a>
  <a class=" svelte-t90z2a" href="/about">about
  </a>
  <a class=" svelte-t90z2a" href="/rss.xml" target="_blank">rss
  </a>
  <a style="display: none;" href="/sitemap.xml" target="_blank" class="svelte-t90z2a">sitemap
  </a>
</nav>
      <a href="https://www.nicovideo.jp/watch/sm9244874" target="_blank" rel="noreferrer noopener" class="svelte-1swke90"><img src="data:image/gif;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAABbl4Awr28AAAAAAC4pp4ACgUAAFomhAB4aGEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiQiQiIkREREREJCIiQRERERESIiJBEhEREREiIkFCQRFRESIiQRIRERFRIiJBEREREREiIkE2ZmZmESQiQWYAAAZhJCJBZgAABmEkIkFmAAAGYSQiQWYAAAZhRCJBZgAABmFEIkE2ZmZmMUQiQRERERERRCJERERERERCLABwAAgAMAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAwAA" alt="logo" style="width: 36px; height: 42px;">
</a></div>
    
<div id="progress-bar" style="--scrollAmount: 0%;" class="svelte-1gbseey"></div></div>
</header>

  <main class="svelte-1brf9ih"><header class="svelte-5uw8di"><h1 class="title svelte-5uw8di"><span style="animation-delay: 125ms; " class="svelte-5uw8di">使
      </span><span style="animation-delay: 150ms; " class="svelte-5uw8di">用
      </span><span style="animation-delay: 175ms; width: .25em;" class="svelte-5uw8di"> 
      </span><span style="animation-delay: 200ms; " class="svelte-5uw8di">G
      </span><span style="animation-delay: 225ms; " class="svelte-5uw8di">o
      </span><span style="animation-delay: 250ms; " class="svelte-5uw8di">o
      </span><span style="animation-delay: 275ms; " class="svelte-5uw8di">g
      </span><span style="animation-delay: 300ms; " class="svelte-5uw8di">l
      </span><span style="animation-delay: 325ms; " class="svelte-5uw8di">e
      </span><span style="animation-delay: 350ms; width: .25em;" class="svelte-5uw8di"> 
      </span><span style="animation-delay: 375ms; " class="svelte-5uw8di">S
      </span><span style="animation-delay: 400ms; " class="svelte-5uw8di">h
      </span><span style="animation-delay: 425ms; " class="svelte-5uw8di">e
      </span><span style="animation-delay: 450ms; " class="svelte-5uw8di">e
      </span><span style="animation-delay: 475ms; " class="svelte-5uw8di">t
      </span><span style="animation-delay: 500ms; width: .25em;" class="svelte-5uw8di"> 
      </span><span style="animation-delay: 525ms; " class="svelte-5uw8di">作
      </span><span style="animation-delay: 550ms; " class="svelte-5uw8di">為
      </span><span style="animation-delay: 575ms; " class="svelte-5uw8di">資
      </span><span style="animation-delay: 600ms; " class="svelte-5uw8di">料
      </span><span style="animation-delay: 625ms; " class="svelte-5uw8di">庫
      </span></h1>
  <p class="meta svelte-5uw8di"><span class="date svelte-5uw8di">Jul 23, 2022</span>
    <div class="tags svelte-5uw8di"><span class="tag svelte-5uw8di">F2E</span><span class="tag svelte-5uw8di">Toolbox</span></div></p></header>
<div class="post--container svelte-5uw8di"><article class="post--content svelte-5uw8di"><h2 id="js-id-介紹">介紹</h2>
<ul><li>Google 的 Sheet API 可以直接將 Sheet 內容轉換成 JSON 格式輸出</li>
<li>亦可從外部傳進資料，修改 Sheet 裡的內容</li>
<li>並且都有提供 CORS 支援，可免於處理跨域的困擾</li></ul>
<h2 id="js-id-實作">實作</h2>
<h3>1. [純讀取] Spreadsheets Data API</h3>
<ul><li>發佈表單<ul><li>「檔案（File）」</li>
<li>「發佈到網路（Publish to the web）」</li>
<li>選擇要發佈的 Sheet／發佈整份文件</li>
<li>點擊「發佈（Publish）」</li></ul></li>
<li>複製原始表單網址裡 <code>[sheet-id]</code> 的部份<ul><li><code>https://docs.google.com/spreadsheets/d/[sheet-id]/</code></li>
<li>注意：不是發佈頁面的連結網址，是<strong>表單的網址</strong></li></ul></li>
<li>從 API 取得資料<ul><li>將 <code>[sheet-id]</code> 貼至 Spreadsheets Data API 網址裡的對應處</li>
<li><code>https://spreadsheets.google.com/feeds/cells/[sheet-id]/[sheet-index]/public/values?alt=json</code></li>
<li><code>https://spreadsheets.google.com/feeds/list/[sheet-id]/[sheet-index]/public/values?alt=json</code><ul><li>預設格式為 xml，在後面加上 <code>?alt=json</code> 改為取得 JSON 格式</li></ul></li>
<li><code>[sheet-index]</code> 可以指定要取得表單裡的哪個分頁</li>
<li>ex: <code>https://spreadsheets.google.com/feeds/cells/[sheet-id]/1/public/values?alt=json</code><ul><li><code>od6</code> 似乎是 API 的預設值？</li></ul></li></ul></li>
<li>主要內容在 <code>feed.entry.content</code> 或 <code>feed.entry.gs$cell</code> 裡</li></ul>
<p>資料架構：</p>
<pre class="language-json"><!-- HTML_TAG_START --><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0"</span><span class="token punctuation">,</span>
  <span class="token property">"encoding"</span><span class="token operator">:</span> <span class="token string">"UTF-8"</span><span class="token punctuation">,</span>
  <span class="token property">"feed"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"xmlns"</span><span class="token operator">:</span> <span class="token string">"http://www.w3.org/2005/Atom"</span><span class="token punctuation">,</span>
    ...
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
      <span class="token property">"$t"</span><span class="token operator">:</span> <span class="token string">"Sheet1"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"link"</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
    ...
    <span class="token property">"entry"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>...<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        ...
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"$t"</span><span class="token operator">:</span> <span class="token string">"content"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token property">"link"</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"gs$cell"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"row"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"col"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token property">"$t"</span><span class="token operator">:</span> <span class="token string">"content"</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      ...
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<h3>2. [可讀寫] Google Apps Script</h3>
<ul><li>建立 GAS 檔案<ul><li>「Extensions」</li>
<li>「指令碼編輯器（Script editor）」</li></ul></li>
<li>撰寫 GAS<ul><li>預設以 <code>doGet()</code> 處理 GET 要求、<code>doPost()</code> 處理 POST 要求</li>
<li>詳見下方範例</li></ul></li>
<li>發佈 API<ul><li>「發佈（Publish）」</li>
<li>「部署為網路應用程式…（Deploy as web app…）」</li>
<li>「將應用程式執行為（Execute the app as）」：<strong>「我（Me）」</strong></li>
<li>「具有應用程式存取權的使用者（Who has access to the app）」：<strong>「任何人，甚至匿名使用者（Anyone, even anonymous）」</strong></li>
<li>「部署（Deploy）」→「核對權限」→選擇授權用的 Google 帳號→「進階」→「前往（此應用程式名稱）」→ 允許</li>
<li>「app URL」即為讀取與寫入用的網址</li></ul></li>
<li>更改程式<ul><li>更新 GAS 程式後，在重新發佈時，「專案版本（Project version）」要選擇「新增（New）」</li>
<li>既有數字是之前點擊發佈時的版本，不會反應最新的修改內容</li>
<li>改動後一定要選擇「新增」專案版本，才會有效反應</li></ul></li></ul>
<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript"><span class="token comment">// 複製 Sheet 網址裡 [sheet-id] 的部份</span>
<span class="token comment">// https://docs.google.com/spreadsheets/d/[sheet-id]/</span>
<span class="token keyword">const</span> SpreadSheetID <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token comment">// 下方的分頁名稱</span>
<span class="token keyword">const</span> sheetName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// accept object as parameter</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> e<span class="token punctuation">.</span>parameter<span class="token punctuation">;</span>
  <span class="token keyword">const</span> SpreadSheet <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">openById</span><span class="token punctuation">(</span>SpreadSheetID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> Sheet <span class="token operator">=</span> SpreadSheet<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>sheetName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// wouldn't return category row (the first row) by default</span>
  <span class="token keyword">const</span> row <span class="token operator">=</span> params<span class="token punctuation">.</span>row <span class="token operator">?</span> params<span class="token punctuation">.</span>row <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> col <span class="token operator">=</span> params<span class="token punctuation">.</span>col <span class="token operator">?</span> params<span class="token punctuation">.</span>col <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> rowRange <span class="token operator">=</span>
    params<span class="token punctuation">.</span>endRow <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">.</span>row
      <span class="token operator">?</span> params<span class="token punctuation">.</span>endRow <span class="token operator">-</span> params<span class="token punctuation">.</span>row <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token operator">:</span> Sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> colRange <span class="token operator">=</span>
    params<span class="token punctuation">.</span>endCol <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">.</span>col
      <span class="token operator">?</span> params<span class="token punctuation">.</span>endCol <span class="token operator">-</span> params<span class="token punctuation">.</span>col <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token operator">:</span> Sheet<span class="token punctuation">.</span><span class="token function">getLastColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rowRange <span class="token operator">></span> Sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> rowRange <span class="token operator">=</span> Sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>colRange <span class="token operator">></span> Sheet<span class="token punctuation">.</span><span class="token function">getLastColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> colRange <span class="token operator">=</span> Sheet<span class="token punctuation">.</span><span class="token function">getLastColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> Sheet<span class="token punctuation">.</span><span class="token function">getSheetValues</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> rowRange<span class="token punctuation">,</span> colRange<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ContentService<span class="token punctuation">.</span><span class="token function">createTextOutput</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMimeType</span><span class="token punctuation">(</span>
    ContentService<span class="token punctuation">.</span>MimeType<span class="token punctuation">.</span><span class="token constant">JSON</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> e<span class="token punctuation">.</span>parameter<span class="token punctuation">;</span>
  <span class="token keyword">const</span> SpreadSheet <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">openById</span><span class="token punctuation">(</span>SpreadSheetID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> Sheet <span class="token operator">=</span> SpreadSheet<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>sheetName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> NewRow <span class="token operator">=</span> Sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment">// customize data key here</span>
  <span class="token keyword">const</span> dataKey <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// add Timestamp in the first column</span>
  Sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>NewRow<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setNumberFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd hh:mm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// add data by keys to the last row</span>
  dataKey<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    Sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>NewRow<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> ContentService<span class="token punctuation">.</span><span class="token function">createTextOutput</span><span class="token punctuation">(</span><span class="token string">"POST success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<ul><li>GAS 的回傳資料格式<ul><li>字串：<code>return ContentService.createTextOutput(&quot;GET 回傳字串&quot;);</code></li>
<li>HTML：<code>return HtmlService.createHtmlOutput(HTMLString);</code></li>
<li>JSON： <pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript">  <span class="token keyword">const</span> JSONString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ContentService<span class="token punctuation">.</span><span class="token function">createTextOutput</span><span class="token punctuation">(</span>JSONString<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMimeType</span><span class="token punctuation">(</span>
    ContentService<span class="token punctuation">.</span>MimeType<span class="token punctuation">.</span><span class="token constant">JSON</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre></li></ul></li>
<li>傳送參數<ul><li><code>const appUrl = new URL(&quot;[app url]&quot;);</code></li>
<li><code>appUrl.search = new URLSearchParams({ action: &quot;getAll&quot; }).toString();</code></li></ul></li></ul>
<h2 id="js-id-參考文章">參考文章</h2>
<ul><li><a href="https://medium.com/unalai/%E5%AF%AB%E7%B5%A6%E7%B4%94%E5%89%8D%E7%AB%AF-%E8%AE%93-google-sheets-%E7%95%B6%E4%BD%A0%E7%9A%84%E5%BE%8C%E7%AB%AF%E5%AE%8C%E6%88%90%E5%AF%AB%E5%85%A5%E5%8A%9F%E8%83%BD-715799e5e013" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://medium.com/unalai/%E5%AF%AB%E7%B5%A6%E7%B4%94%E5%89%8D%E7%AB%AF-%E8%AE%93-google-sheets-%E7%95%B6%E4%BD%A0%E7%9A%84%E5%BE%8C%E7%AB%AF%E5%AE%8C%E6%88%90%E5%AF%AB%E5%85%A5%E5%8A%9F%E8%83%BD-715799e5e013" alt="寫給純前端，讓 Google Sheets 當你的後端完成寫入功能"><span>寫給純前端，讓 Google Sheets 當你的後端完成寫入功能</span></a></li>
<li><a href="https://tutorials.webduino.io/zh-tw/docs/socket/useful/google-sheet-2.html" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://tutorials.webduino.io/zh-tw/docs/socket/useful/google-sheet-2.html" alt="Google 試算表 (前後端實作)"><span>Google 試算表 (前後端實作)</span></a></li>
<li><a href="https://g0v.hackpad.tw/5Ofw64qSz7P#:h=Google-Spreadsheet" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://g0v.hackpad.tw/5Ofw64qSz7P#:h=Google-Spreadsheet" alt="盤點各種線上協作資料(庫)方案 - g0v.hackpad.tw"><span>盤點各種線上協作資料(庫)方案 - g0v.hackpad.tw</span></a></li></ul>
<h2 id="js-id-gas">GAS</h2>
<ul><li>GET<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript">  <span class="token keyword">function</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>parameter<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token function">getHandler</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></li>
<li>POST<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript">  <span class="token keyword">function</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> parameter <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>postData<span class="token punctuation">.</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> parameter<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token function">postHandler</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre></li>
<li>TRIGGER<ul><li><code>onEdit()</code></li></ul></li>
<li>Read<ul><li><code>SpreadsheetApp.getActiveSpreadsheet()</code></li>
<li><code>Spreadsheet#getSheetByName(name)</code></li>
<li><code>Sheet#getRange(row, column)</code></li>
<li><code>Sheet#getRange(row, column, numRows)</code></li>
<li><code>Sheet#getRange(row, column, numRows, numColumns)</code></li>
<li><code>Sheet#getRange(cellRangeNotation)</code><ul><li>ex: <code>getRange(&quot;A1:B2&quot;)</code></li></ul></li>
<li><code>Range#getValues()</code><ul><li>ex. <code>const values = sheet.getRange(&quot;A1:C2&quot;).getValues();</code></li>
<li><code>const values = sheet.getRange(&quot;A1:C2&quot;).getValues().flat();</code></li></ul></li></ul></li>
<li>Write<ul><li><code>Range#setValues(values)</code></li>
<li><pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript">  <span class="token keyword">const</span> rowLength <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> colLength <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> rowLength<span class="token punctuation">,</span> colLength<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValues</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre></li></ul></li>
<li><a href="https://developers.google.com/apps-script/reference/utilities/utilities" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://developers.google.com/apps-script/reference/utilities/utilities" alt="Utilities"><span>Utilities</span></a></li>
<li>Use library<ul><li>Resources</li>
<li>Libraries</li>
<li>於 <code>add library</code> 貼上 script id</li>
<li>追加</li>
<li><a href="https://github.com/tani/cheeriogs" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://github.com/tani/cheeriogs" alt="Cheeriogs"><span>Cheeriogs</span></a></li></ul></li>
<li>Timestamp<ul><li><code>Utilities.formatDate(new Date(), &quot;Asia/Taipei&quot;, &quot;顯示格式&quot;);</code></li>
<li><code>顯示格式</code><ul><li><code>年：y</code></li>
<li><code>月：M</code></li>
<li><code>日：d</code></li>
<li><code>時（12 小時制）：h</code></li>
<li><code>時（24 小時制）：H</code></li>
<li><code>分：m</code></li>
<li><code>秒：s</code></li>
<li><code>&#39;yyyy/MM/dd/HH:mm&#39;</code> → <code>2020/12/31/23:59</code></li></ul></li></ul></li>
<li>Message Box<ul><li><code>if (Browser.msgBox(&quot;確認&quot;, &quot;是否要執行？&quot;, Browser.Buttons.YES_NO) != &quot;yes&quot;)</code></li></ul></li>
<li>Hash<ul><li><code>var md5bin = Utilities.computeDigest(Utilities.DigestAlgorithm.MD5, text);</code></li>
<li><code>var md5 = Utilities.base64Encode(md5bin);</code></li></ul></li></ul>
<h3>撰寫 Discord Webhook</h3>
<ul><li>建立 Webhook<ul><li>點擊 Discord 頻道右邊的齒輪鍵</li>
<li>點擊 <code>Integrations</code> -&gt; <code>Create Webhook</code> -&gt; <code>Copy Webhook URL</code></li></ul></li>
<li>撰寫 GAS</li>
<li><a href="https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app" alt="UrlFetchApp"><span>UrlFetchApp</span></a></li>
<li><code>UrlFetchApp.fetch(url[, params])</code></li>
<li>params<ul><li><code>contentType</code></li>
<li><code>headers</code></li>
<li><code>method</code></li>
<li><code>payload</code></li></ul></li>
<li>response<ul><li><code>getContentText()</code></li>
<li><code>getHeaders()</code></li>
<li><code>getResponseCode()</code></li>
<li><code>getBlob()</code></li></ul></li></ul>
<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sendToDiscord</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> url      <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 上方建立的 Webhook 網址</span>
  <span class="token keyword">const</span> token    <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// Webhook 網址後半的 token 部份</span>
                       <span class="token comment">// * 未確認是否已不需要</span>
  <span class="token keyword">const</span> channel  <span class="token operator">=</span> <span class="token string">'#general'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> text     <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token string">'bot'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> parse    <span class="token operator">=</span> <span class="token string">'full'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> method   <span class="token operator">=</span> <span class="token string">'POST'</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'token'</span>     <span class="token operator">:</span> token<span class="token punctuation">,</span>
    <span class="token string-property property">'channel'</span>   <span class="token operator">:</span> channel<span class="token punctuation">,</span>
    <span class="token string-property property">'content'</span>   <span class="token operator">:</span> text<span class="token punctuation">,</span>
    <span class="token string-property property">'username'</span>  <span class="token operator">:</span> username<span class="token punctuation">,</span>
    <span class="token string-property property">'parse'</span>     <span class="token operator">:</span> parse<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'method'</span><span class="token operator">:</span> method<span class="token punctuation">,</span>
    <span class="token string-property property">'payload'</span><span class="token operator">:</span> payload<span class="token punctuation">,</span>
    <span class="token string-property property">'muteHttpExceptions'</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  response <span class="token operator">=</span> UrlFetchApp<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code><!-- HTML_TAG_END --></pre>
<h3>Save as excel file</h3>
<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript"><span class="token keyword">var</span> sheetID <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fetchUrl <span class="token operator">=</span>
  <span class="token string">"https://docs.google.com/feeds/download/spreadsheets/Export?key="</span> <span class="token operator">+</span>
  sheetID <span class="token operator">+</span>
  <span class="token string">"&amp;amp;exportFormat=xlsx"</span><span class="token punctuation">;</span>

<span class="token comment">//OAuth</span>
<span class="token keyword">var</span> fetchOpt <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> ScriptApp<span class="token punctuation">.</span><span class="token function">getOAuthToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">muteHttpExceptions</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> xlsxFile <span class="token operator">=</span> UrlFetchApp<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>fetchUrl<span class="token punctuation">,</span> fetchOpt<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getBlob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"filename.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<h3>參考文章</h3>
<ul><li><a href="https://github.com/contributorpw/google-apps-script-awesome-list#parsing" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://github.com/contributorpw/google-apps-script-awesome-list#parsing" alt="google-apps-script-awesome-list"><span>google-apps-script-awesome-list</span></a></li>
<li><a href="https://qiita.com/matsu7089/items/6ea7931e97ae703f6607?utm_campaign=6922a8b5e9-Qiita_newsletter_419_07_15_2020&utm_term=0_e44feaa081-6922a8b5e9-34565689#%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B-onget-%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/matsu7089/items/6ea7931e97ae703f6607?utm_campaign=6922a8b5e9-Qiita_newsletter_419_07_15_2020&utm_term=0_e44feaa081-6922a8b5e9-34565689#%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B-onget-%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B" alt="【GAS x Vue.js】JavaScript のみで今、家計簿をつくるとしたら【ハンズオン付き！】"><span>【GAS x Vue.js】JavaScript のみで今、家計簿をつくるとしたら【ハンズオン付き！】</span></a></li>
<li><a href="https://qiita.com/hironobu-igawa/items/9b5c224d9bbe7b9843be" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/hironobu-igawa/items/9b5c224d9bbe7b9843be" alt="【初心者向け Tips】単純作業はもう嫌だ！GAS ツール作りの 4 つの技"><span>【初心者向け Tips】単純作業はもう嫌だ！GAS ツール作りの 4 つの技</span></a></li>
<li><a href="https://qiita.com/FUJIvillage/items/e22ad7efdf7fc898ffda" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/FUJIvillage/items/e22ad7efdf7fc898ffda" alt="Google Apps Script（GAS）を利用した業務改善"><span>Google Apps Script（GAS）を利用した業務改善</span></a></li>
<li><a href="https://qiita.com/mitonattou919/items/de415bb9302a52d52e2e" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/mitonattou919/items/de415bb9302a52d52e2e" alt="Google Apps Script の割り当て値と制限値"><span>Google Apps Script の割り当て値と制限値</span></a></li>
<li><a href="https://qiita.com/shikumiya_hata/items/5e11ff875a9dd050a722" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/shikumiya_hata/items/5e11ff875a9dd050a722" alt="GAS でライブラリを使う・作る方法"><span>GAS でライブラリを使う・作る方法</span></a></li>
<li><a href="https://qiita.com/TakeshiNickOsanai/items/62810b0e96bf37bd0eca" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/TakeshiNickOsanai/items/62810b0e96bf37bd0eca" alt="Google Apps Script + OAuth ライブラリで、freee API の操作を行う"><span>Google Apps Script + OAuth ライブラリで、freee API の操作を行う</span></a></li>
<li><a href="https://qiita.com/yamaguchi_yo/items/09bfc5c32faffa3beb62" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/yamaguchi_yo/items/09bfc5c32faffa3beb62" alt="法改正情報を早く確実にキャッチするために GAS で自動化するツールを作って運用してみた。"><span>法改正情報を早く確実にキャッチするために GAS で自動化するツールを作って運用してみた。</span></a></li>
<li><a href="https://qiita.com/cyoi0129/items/1cafb446dbe176e9366e" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/cyoi0129/items/1cafb446dbe176e9366e" alt="スクレイピングいろいろ"><span>スクレイピングいろいろ</span></a></li>
<li><a href="https://qiita.com/tapatyo/items/465a982635ba3933b32d" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/tapatyo/items/465a982635ba3933b32d" alt="【Google Apps Script】トリガーによる定期実行の時間のズレをなくす方法"><span>【Google Apps Script】トリガーによる定期実行の時間のズレをなくす方法</span></a></li></ul>
<h2 id="js-id-google-form">Google Form</h2>
<ol><li>先使用 Google Form 製作好和需求相同形式的表單</li>
<li>點擊右上預覽表單</li>
<li>開啟開發者工具</li>
<li>尋找 <code>&lt;form&gt;</code> 標籤的 <code>action</code> 屬性中的傳送表單網址<ul><li><code>action=[表單網址]</code></li>
<li><code>https://docs.google.com/forms/u/0/d/e/xxxxxxx/formResponse</code></li></ul></li>
<li>尋找所有提問的 id<ul><li><code>name=[提問 ID]</code></li>
<li>通常為 <code>entry.xxxxxxx</code>，可使用此關鍵字快速搜尋</li></ul></li>
<li>另外撰寫表格網頁，將傳送行為綁定至自訂的傳送按鍵上</li></ol>
<h3>參考文章</h3>
<ul><li><a href="https://qiita.com/inoue2002/items/78dac54dba93ea4a087a" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/inoue2002/items/78dac54dba93ea4a087a" alt="独自フォームと Google フォームを連携してかっこよくスマートにアンケート回収する"><span>独自フォームと Google フォームを連携してかっこよくスマートにアンケート回収する</span></a></li>
<li><a href="https://qiita.com/Robot-Inventor/items/56e2b7b69760d045fad3" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://qiita.com/Robot-Inventor/items/56e2b7b69760d045fad3" alt="【2020 年最新版】カスタマイズしたフォームから JavaScript で Google フォームに回答を送信"><span>【2020 年最新版】カスタマイズしたフォームから JavaScript で Google フォームに回答を送信</span></a></li>
<li><a href="https://valmore.work/auto-response-from-google-form/" rel="noopener" target="_blank"><img src="https://s2.googleusercontent.com/s2/favicons?domain=https://valmore.work/auto-response-from-google-form/" alt="【GAS】自動返信機能付き Google フォームの作り方"><span>【GAS】自動返信機能付き Google フォームの作り方</span></a></li></ul>
<div class="toc-container"><ul class="toc"><li><a href="#" onclick="document.querySelector('#js-id-介紹').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">介紹</a></li><li><a href="#" onclick="document.querySelector('#js-id-實作').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">實作</a></li><li><a href="#" onclick="document.querySelector('#js-id-參考文章').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">參考文章</a></li><li><a href="#" onclick="document.querySelector('#js-id-gas').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">GAS</a></li><li><a href="#" onclick="document.querySelector('#js-id-google-form').scrollIntoView(); window.scrollBy(0, -128); event.preventDefault();">Google Form</a></li></ul></div>
    <span class="blink svelte-1kip24n">_</span></article>
  

<div class="back-to-top svelte-1p7rwza hidden" style="right: 2em">Back to top
</div>
</div></main>

  <footer scoped class="svelte-1xo47ws"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer noopener nofollow">CC BY-NC-SA 4.0
  </a>
  <div class="right svelte-1xo47ws">Made with <span class="heart svelte-1xo47ws">❤️</span> and
    <a href="https://kit.svelte.dev/" target="_blank" ref="noreferrer noopener nofollow">SvelteKit
    </a></div>
  <div class="clearfix svelte-1xo47ws"></div>
</footer>
</div>


		<script type="module" data-hydrate="1lv7vc9">
		import { start } from "/_app/start-733206bd.js";
		start({
			target: document.querySelector('[data-hydrate="1lv7vc9"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [
					import("/_app/pages/__layout.svelte-5611d17c.js"),
						import("/_app/pages/posts/use-google-spreadsheet-as-database.md-a930d868.js")
				],
				params: {},
				routeId: "posts/use-google-spreadsheet-as-database"
			}
		});
	</script>
  </body>
</html>
