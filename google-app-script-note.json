{"title":"Google App Script 筆記","slug":"google-app-script-note","html":"<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/contributorpw/google-apps-script-awesome-list#parsing\">contributorpw/google-apps-script-awesome-list: The usual list of links to interesting resources for Google Apps Script</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/matsu7089/items/6ea7931e97ae703f6607?utm_campaign=6922a8b5e9-Qiita_newsletter_419_07_15_2020&amp;utm_term=0_e44feaa081-6922a8b5e9-34565689#%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B-onget-%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B\">【GAS x Vue.js】JavaScript のみで今、家計簿をつくるとしたら【ハンズオン付き！】 - Qiita</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/hironobu-igawa/items/9b5c224d9bbe7b9843be\">【初心者向け Tips】単純作業はもう嫌だ！GAS ツール作りの 4 つの技 - Qiita</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/FUJIvillage/items/e22ad7efdf7fc898ffda\">Google Apps Script（GAS）を利用した業務改善 - Qiita</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/mitonattou919/items/de415bb9302a52d52e2e\">Google Apps Script の割り当て値と制限値 - Qiita</a></li>\n</ul>\n<h2 id=\"get--post\">GET / POST</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>parameter<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> parameter <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>postData<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> parameter<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">postHandler</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><h2 id=\"sheet-handler\">Sheet Handler</h2>\n<h3 id=\"read\">Read</h3>\n<ul>\n<li><code>SpreadsheetApp.getActiveSpreadsheet()</code></li>\n<li><code>Spreadsheet#getSheetByName(name)</code></li>\n<li><code>Sheet#getRange(row, column)</code></li>\n<li><code>Sheet#getRange(row, column, numRows)</code></li>\n<li><code>Sheet#getRange(row, column, numRows, numColumns)</code></li>\n<li><code>Sheet#getRange(cellRangeNotation)</code>\n<br>└ ex: <code>getRange(&quot;A1:B2&quot;)</code></li>\n<li><code>Range#getValues()</code>\n<br>│ ex. <code>const values = sheet.getRange(&quot;A1:C2&quot;).getValues();</code>\n<br>└ <code>const values = sheet.getRange(&quot;A1:C2&quot;).getValues().flat();</code></li>\n</ul>\n<h3 id=\"write\">Write</h3>\n<ul>\n<li><code>Range#setValues(values)</code></li>\n</ul>\n<h4 id=\"寫入整個陣列內容\">寫入整個陣列內容</h4>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> rowLength <span class=\"token operator\">=</span> array<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> colLength <span class=\"token operator\">=</span> array<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\nsheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> rowLength<span class=\"token punctuation\">,</span> colLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValues</span><span class=\"token punctuation\">(</span>array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h3 id=\"edit-trigger\">Edit Trigger</h3>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">onEdit</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//目当てのシートでなければ中断</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>range<span class=\"token punctuation\">.</span><span class=\"token function\">getSheet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSheetName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"シート名\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">//ヘッダ行だった場合も中断</span>\n  <span class=\"token keyword\">const</span> row <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>range<span class=\"token punctuation\">.</span><span class=\"token function\">getRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> today <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Asia/Tokyo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yyyy/MM/dd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> time <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Asia/Tokyo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HH:mm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//A1セルに８桁の年月日 B1セルに２４時間表記の時刻</span>\n  <span class=\"token keyword\">var</span> spreadsheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">getActiveSpreadsheet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSheetByName</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"シート名\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  spreadsheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>today<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  spreadsheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><h2 id=\"use-library\">Use Library</h2>\n<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/shikumiya_hata/items/5e11ff875a9dd050a722\">GAS でライブラリを使う・作る方法 - Qiita</a></li>\n<li>開啟 App Script 程式碼頁面\n<br>├ -&gt; Resources -&gt; Libraries\n<br>├ -&gt; 複製 cheeriogs 的說明頁面裡的 script ID\n<br>└ -&gt; 貼至下方的 add library -&gt; 追加</li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/TakeshiNickOsanai/items/62810b0e96bf37bd0eca\">Google Apps Script + OAuth ライブラリで、freee API の操作を行う - Qiita</a></li>\n</ul>\n<h2 id=\"crawler\">Crawler</h2>\n<h3 id=\"urlfetchapp\"><a target=\"_blank\" rel=\"nofollow\" href=\"https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app\">UrlFetchApp</a></h3>\n<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/yamaguchi_yo/items/09bfc5c32faffa3beb62\">法改正情報を早く確実にキャッチするために GAS で自動化するツールを作って運用してみた。 - Qiita</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/cyoi0129/items/1cafb446dbe176e9366e\">スクレイピングいろいろ - Qiita</a></li>\n</ul>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> sheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">getActiveSpreadsheet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSheetByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"urlリスト\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> rows <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getDataRange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> numRows <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">.</span><span class=\"token function\">getNumRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> values <span class=\"token operator\">=</span> rows<span class=\"token punctuation\">.</span><span class=\"token function\">getValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 一行ずつチェック</span>\n<span class=\"token keyword\">var</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> numRows <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> row <span class=\"token operator\">=</span> values<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// GSSから対象URLの値を取得</span>\n  <span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 前回のハッシュ値</span>\n  <span class=\"token keyword\">var</span> hash <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// htmlを取得</span>\n  <span class=\"token keyword\">var</span> html <span class=\"token operator\">=</span> UrlFetchApp<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> text <span class=\"token operator\">=</span> html<span class=\"token punctuation\">.</span><span class=\"token function\">getContentText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ハッシュ値を計算</span>\n  <span class=\"token keyword\">var</span> md5bin <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">computeDigest</span><span class=\"token punctuation\">(</span>Utilities<span class=\"token punctuation\">.</span>DigestAlgorithm<span class=\"token punctuation\">.</span><span class=\"token constant\">MD5</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> md5 <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">base64Encode</span><span class=\"token punctuation\">(</span>md5bin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 前回と同じならスキップ</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hash <span class=\"token operator\">==</span> md5<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n  results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>md5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>results<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"更新はありませんでした。\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><h3 id=\"cheeriogs\"><a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/tani/cheeriogs\">Cheeriogs</a></h3>\n<ul>\n<li>cheerio 的 Google Sheet 版</li>\n<li>可以用類似 jQuery 的語法解析 HTML 內容</li>\n</ul>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> htmlContent <span class=\"token operator\">=</span> UrlFetchApp<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContentText</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UTF-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> Cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>htmlContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> title <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nret<span class=\"token punctuation\">[</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> title<span class=\"token punctuation\">;</span>\nret<span class=\"token punctuation\">[</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"meta[name='description']\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nret<span class=\"token punctuation\">[</span><span class=\"token string\">\"pref\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> title<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"赤十字血液センター｜日本赤十字社\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nret<span class=\"token punctuation\">[</span><span class=\"token string\">\"demand_date\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".center-main-today-timedate\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nret<span class=\"token punctuation\">[</span><span class=\"token string\">\"demands\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".center-main-today-types-state\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index<span class=\"token punctuation\">,</span> element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  ret<span class=\"token punctuation\">[</span><span class=\"token string\">\"demands\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h2 id=\"discord-webhook\">Discord Webhook</h2>\n<h3 id=\"url-fetch-app\">URL Fetch App</h3>\n<ul>\n<li><code>UrlFetchApp.fetch(url[, params])</code></li>\n</ul>\n<h4 id=\"parameters\">parameters</h4>\n<table>\n<thead>\n<tr>\n<th>parameter</th>\n<th>type</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>url</td>\n<td>String</td>\n<td>傳送 HTTP Request 的目標網址</td>\n</tr>\n<tr>\n<td>params.contentType</td>\n<td>String</td>\n<td>Request 的 Content-Type</td>\n</tr>\n<tr>\n<td>params.headers</td>\n<td>Object</td>\n<td>設定 Request Header 的 key/value object</td>\n</tr>\n<tr>\n<td>params.method</td>\n<td>String</td>\n<td>指定使用何種 method，預設為 <code>GET</code></td>\n</tr>\n<tr>\n<td>params.payload</td>\n<td>String</td>\n<td>指定 Request Body。<code>GET</code> 時無法指定。指定後會被視為 <code>application/x-www-form-urlencoded</code> 或 <code>multipart/form-data</code></td>\n</tr>\n</tbody></table>\n<h4 id=\"handle-response\">Handle Response</h4>\n<table>\n<thead>\n<tr>\n<th>method</th>\n<th>type</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>getContentText()</td>\n<td>String</td>\n<td>取得 Response Body</td>\n</tr>\n<tr>\n<td>getHeaders()</td>\n<td>Object</td>\n<td>取得 Response Header</td>\n</tr>\n<tr>\n<td>getResponseCode()</td>\n<td>Integer</td>\n<td>取得回傳的 HTTP 狀態</td>\n</tr>\n</tbody></table>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  channel<span class=\"token operator\">:</span> <span class=\"token string\">\"sample\"</span><span class=\"token punctuation\">,</span>\n  text<span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nresponse <span class=\"token operator\">=</span> UrlFetchApp<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"https://slack.com/api/chat.postMessage\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    contentType<span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span>\n    headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"Authorization\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bearer xoxp-xxxxxxxxx-xxxx\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    method<span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getResponseCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// output: 200</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getContentText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// output: '{ \"OK\": true, ... }'</span></code></pre><h3 id=\"建立-webhook\">建立 Webhook</h3>\n<ol>\n<li>點擊 Discord 頻道右邊的齒輪鍵</li>\n<li>點擊畫面左邊的 <code>Integrations</code> -&gt; <code>Create Webhook</code> -&gt; <code>Copy Webhook URL</code></li>\n</ol>\n<h3 id=\"撰寫-gas\">撰寫 GAS</h3>\n<p><code>Google App Script</code></p>\n<pre class=\"language-javaScript\"><code class=\"language-javaScript\">function sendToDiscord(message) {\n  const url      = ''; // 上方建立的 Webhook 網址\n  const token    = ''; // Webhook 網址後半的 token 部份\n                       // * 未確認是否已不需要\n  const channel  = '#general';\n  const text     = message;\n  const username = 'bot';\n  const parse    = 'full';\n  const method   = 'POST';\n\n  const payload = {\n    'token'     : token,\n    'channel'   : channel,\n    'content'   : text,\n    'username'  : username,\n    'parse'     : parse,\n  };\n\n  const params = {\n    'method': method,\n    'payload': payload,\n    'muteHttpExceptions': true\n  };\n\n  response = UrlFetchApp.fetch(url, params);\n}</code></pre><h2 id=\"add-timestamp\">Add Timestamp</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 今天</span>\n<span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> today <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Asia/Taipei\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"顯示格式\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 明天 i=1 昨天 i=-1</span>\n<span class=\"token keyword\">var</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndate<span class=\"token punctuation\">.</span><span class=\"token function\">setDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> day <span class=\"token operator\">=</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Asia/Taipei\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"顯示格式\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p><code>顯示格式</code> 的部份可以使用 <code>年：y</code>、<code>月：M</code>、<code>日：d</code>、<code>時（12 小時制）：h</code>、<code>時（24 小時制）：H</code>、<code>分：m</code>、<code>秒：s</code> 自行制定格式</p>\n<p>例：<code>&#39;yyyy/MM/dd/HH:mm&#39;</code> → <code>2020/12/31/23:59</code></p>\n<h2 id=\"set-trigger\">Set Trigger</h2>\n<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/tapatyo/items/465a982635ba3933b32d\">【Google Apps Script】トリガーによる定期実行の時間のズレをなくす方法 - Qiita</a></li>\n</ul>\n<h3 id=\"display-message-box\">Display Message Box</h3>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Browser<span class=\"token punctuation\">.</span><span class=\"token function\">msgBox</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"確認\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"是否要執行？\"</span><span class=\"token punctuation\">,</span> Browser<span class=\"token punctuation\">.</span>Buttons<span class=\"token punctuation\">.</span><span class=\"token constant\">YES_NO</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><h2 id=\"write-gs-code-on-vscode\">Write GS code on VSCode</h2>\n<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://qiita.com/jooji/items/76f07f3f82900ebcd2b8\">[clasp]Google Apps Script を VSCode/Typescript/Git で書く。 - Qiita</a></li>\n</ul>\n<h2 id=\"backup-sheet\">Backup Sheet</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> DriveApp<span class=\"token punctuation\">.</span><span class=\"token function\">getFileById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'File ID'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> folder <span class=\"token operator\">=</span> DriveApp<span class=\"token punctuation\">.</span><span class=\"token function\">getFolderById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Folder ID'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'_'</span> <span class=\"token operator\">+</span> Utilities<span class=\"token punctuation\">.</span><span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JST'</span> <span class=\"token string\">'MM/dd/HH:mm'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfile<span class=\"token punctuation\">.</span><span class=\"token function\">makeCopy</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> folder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h3 id=\"conver-sheet-to-excel-file\">Conver Sheet to excel file</h3>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//エクセルを返すURL</span>\n<span class=\"token keyword\">var</span> fetchUrl <span class=\"token operator\">=</span>\n  <span class=\"token string\">\"https://docs.google.com/feeds/download/spreadsheets/Export?key=\"</span> <span class=\"token operator\">+</span>\n  <span class=\"token string\">\"シートID\"</span> <span class=\"token operator\">+</span>\n  <span class=\"token string\">\"&amp;amp;exportFormat=xlsx\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//OAuth</span>\n<span class=\"token keyword\">var</span> fetchOpt <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> Authorization<span class=\"token operator\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> ScriptApp<span class=\"token punctuation\">.</span><span class=\"token function\">getOAuthToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  muteHttpExceptions<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//エクセルファイルゲット！</span>\n<span class=\"token keyword\">var</span> xlsxFile <span class=\"token operator\">=</span> UrlFetchApp<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>fetchUrl<span class=\"token punctuation\">,</span> fetchOpt<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">getBlob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"任意の名前.xlsx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>","date":"2020-08-25T03:21:09.000Z","excerpt":null,"printDate":"August 25, 2020","printReadingTime":"5 min read","tags":[]}