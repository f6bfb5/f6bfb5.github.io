<!DOCTYPE html> <html lang=zh-Hant-TW> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width,initial-scale=1"> <meta name=theme-color content=#333333> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.png rel=icon type=image/png> <link href=client/client-fdae2e51.css rel=stylesheet><link href=client/[slug]-680d4187.css rel=stylesheet> <title>實作「使用 Discord 登入」</title><script async data-svelte=svelte-a2kvt3 src="https://www.googletagmanager.com/gtag/js?id=UA-114661136-2"></script><script async data-svelte=svelte-1op50db src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js data-ad-client=ca-pub-9613661448556355></script><link href=/apple-touch-icon.png rel=apple-touch-icon data-svelte=svelte-12mb5ri sizes=180x180><link href=/favicon-32x32.png rel=icon data-svelte=svelte-12mb5ri sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon data-svelte=svelte-12mb5ri sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest data-svelte=svelte-12mb5ri><link href=/safari-pinned-tab.svg rel=mask-icon data-svelte=svelte-12mb5ri color=#5bbad5><meta data-svelte=svelte-12mb5ri name=msapplication-TileColor content=#ffc40d><meta data-svelte=svelte-12mb5ri name=theme-color content=#ffffff><link href=https://f6bfb5.github.io/login-with-discord rel=canonical data-svelte=svelte-oowxqk><meta data-svelte=svelte-oowxqk content=https://f6bfb5.github.io/login-with-discord property=og:url><meta data-svelte=svelte-oowxqk content=article property=og:type><meta data-svelte=svelte-oowxqk content="實作「使用 Discord 登入」" property=og:title><meta data-svelte=svelte-oowxqk property=og:description><meta data-svelte=svelte-oowxqk name=Description><meta data-svelte=svelte-oowxqk content=https://f6bfb5.github.io/preview/login-with-discord.png property=og:image><meta data-svelte=svelte-oowxqk name=twitter:card content=summary_large_image><meta data-svelte=svelte-oowxqk name=twitter:title value="實作「使用 Discord 登入」"><meta data-svelte=svelte-oowxqk name=twitter:description><meta data-svelte=svelte-oowxqk name=twitter:label1 value="Published on"><meta data-svelte=svelte-oowxqk name=twitter:data1 value="Jan 14, 2021"> <link href=/client/client.d52f6f0b.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-fdae2e51.css rel=preload as=style><link href=/client/[slug].197b92c9.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/[slug]-680d4187.css rel=preload as=style></head> <body> <div id=sapper> <div class="svelte-iqhm layout"> <header class=svelte-odoyju><nav class=svelte-1c2nkmp><a href=. class=svelte-1c2nkmp>blog</a> <a href=about class=svelte-1c2nkmp>about</a> <a href=rss.xml class=svelte-1c2nkmp>rss</a> </nav> <button class=svelte-jm7ygc><svg height=24 viewBox="0 0 24 24" width=24 xmlns=http://www.w3.org/2000/svg><path d="M17 14v2.639c0 1.776-1.625 2.608-2 4.361h-6c-.369-1.782-2-2.582-2-4.361v-2.639h10zm-2.25 8h-5.5l1.451 1.659c.19.216.465.341.752.341h1.094c.287 0 .562-.125.752-.341l1.451-1.659zm-1.25-22c-1.381 0-2.5 1.119-2.5 2.5v10.5h2v-10.5c0-.276.225-.5.5-.5s.5.224.5.5v10.5h2v-10.5c0-1.381-1.119-2.5-2.5-2.5zm-3.5 2.5c0-.953.386-1.817 1.006-2.449-.163-.033-.333-.051-.506-.051-1.381 0-2.5 1.119-2.5 2.5v10.5h2v-10.5z"></path></svg> </button> <a href=/ class=svelte-133wrba><img class=svelte-133wrba alt="Buddha of Kamakura" src=noun_great_buddha_of_kamakura_3572172.svg> </a> </header> <main class=svelte-iqhm> <header class=svelte-cuszyt><h1 class=svelte-cuszyt>實作「使用 Discord 登入」</h1> <p class=svelte-cuszyt>January 14, 2021 <small class=svelte-cuszyt>3 min read</small></header> <div class="svelte-cuszyt container"><article class=content><ul> <li><a href=https://qiita.com/masayoshi4649/items/46fdb744cb8255f5eb98 target=_blank rel=nofollow>「Discord の ID でログイン」を実装する(Oauth2) - Qiita</a></li> </ul> <h2 id=1-於-discord-developer-portal-登錄-application>1. 於 Discord Developer Portal 登錄 Application</h2> <h3 id=a-取得-「client-id」和「client-secert」>a. 取得 「Client ID」和「Client Secert」</h3> <ol> <li>登入 <a href=https://discord.com/developers/applications target=_blank rel=nofollow>Discord Developer Portal</a></li> <li>點擊右上角的「New Application」</li> <li>取名，本文範例取為 <code>OAuth Vertify</code>，此名稱會顯示於授權頁面上，之後點擊「Create」</li> <li>資訊頁右方的 <code>Client ID</code> 和 <code>Client Secert</code> 後面也會用到</li> </ol> <h3 id=b-建立-oauth-用的網址>b. 建立 OAuth 用的網址</h3> <ol> <li>點擊左側的「OAuth2」分頁</li> <li>點擊右側的「Add Redirect」，輸入要用到驗證登入的網址 <br>例如本文最下方也有附上實作範例 <br>輸入的網址就是 <code>https://f6bfb5.github.io/login-with-discord/</code></li> <li>勾選下方「SCOPE」（索取的資訊欄位） 裡的「identify」（Discord 的 ID）和「email」</li> <li>就可於頁面下方取得認證用的連結 <br>例：<code>https://discord.com/api/oauth2/authorize?client_id=</code>CLIENT ID<code>&redirect_uri=</code>REDIRECT URL<code>&response_type=code&scope=</code>SCOPE</li> </ol> <h2 id=2-從認證連結取得「code」>2. 從認證連結取得「code」</h2> <p>使用此認證連結登入，並重新導向到結果頁面後，網址上會多出一個回傳的 <code>code</code> 參數</p> <h2 id=3-使用「code」取得「token」>3. 使用「code」取得「token」</h2> <p>再使用這個 <code>code</code> 去取得 <code>access_token</code>，才能得到存取資料的權限</p> <h3 id=a-傳送-post-請求到-discord-api>a. 傳送 POST 請求到 Discord API</h3> <pre class=language-bash><code class=language-bash>curl -X POST
     -H "Content-Type:application/x-www-form-urlencoded"
     -d "client_id=CLIENT ID
     &client_secret=CLIENT SECRET
     &grant_type=authorization_code
     &code=CODE
     &redirect_uri=REDIRECT URL（要與認證 URL 相同）"
     https://discordapp.com/api/oauth2/token</code></pre><h3 id=b-若成功就可取得-access-token>b. 若成功就可取得 <code>access token</code></h3> <pre class=language-json><code class=language-json>{
  "access_token": ACCESS TOKEN,
  "expires_in": 604800,
  "refresh_token": REFRESH TOKEN,
  "scope": SCOPE,
  "token_type": "Bearer"
}</code></pre><ul> <li><code>code</code> 為一次性使用，同一個 <code>code</code> 無法進行第二次存取</li> <li><code>access token</code> 的有效期限為 604800 秒＝一個禮拜 <br>若有更新需求，須使用回傳內容中的 <code>refresh token</code> 重新送出請求</li> </ul> <h2 id=4-使用「token」取得使用者資料>4. 使用「token」取得使用者資料</h2> <h3 id=a-傳送-get-請求到-discord-api>a. 傳送 GET 請求到 Discord API</h3> <pre class=language-bash><code class=language-bash>curl -H "Authorization: Bearer ACCESS TOKEN"
     https://discordapp.com/api/users/@me</code></pre><h3 id=b-若順利成功，就可取得相關資料>b. 若順利成功，就可取得相關資料</h3> <pre class=language-json><code class=language-json>{
   "id": Discord ID,
   "username": 使用者名稱,
   "avatar": 大頭貼 ID,
   "discriminator": 使用者編號（在名稱#後面的數字）,
   "public_flags": 0,
   "flags": 0,
   "email": 信箱,
   "verified": true,
   "locale": 使用語言,
   "mfa_enabled": false
}</code></pre><ul> <li>頭像可以使用「<code>https://cdn.discordapp.com/avatars/</code>Discord ID<code>/</code>大頭貼 ID」取得</li> </ul> <h2 id=5-使用-refresh-token-重新取得-access-token>5. 使用 refresh token 重新取得 access token</h2> <h3 id=a-傳送-post-請求到-discord-api-1>a. 傳送 POST 請求到 Discord API</h3> <pre class=language-bash><code class=language-bash>curl -X POST
     -H "Content-Type:application/x-www-form-urlencoded"
     -d "client_id=CLIENT ID
     &client_secret=CLIENT SECRET
     &grant_type=refresh_token
     &refresh_token=REFRESH TOKEN"
     https://discordapp.com/api/oauth2/token</code></pre><h3 id=b-若成功就可取得-access-token-1>b. 若成功就可取得 access token</h3> <pre class=language-json><code class=language-json>{
   "access_token": ACCESS TOKEN,
   "expires_in": 604800,
   "refresh_token": REFRESH TOKEN,
   "scope": SCOPE,
   "token_type": "Bearer"
}</code></pre><h2 id=範例>範例</h2> <p>以下示範透過此方式，取得你的 Discord ID 與大頭貼圖片。 <br>如果未顯示「Not logged in」或點擊按鍵無反應，請重新整理頁面。</p> <p><button id=js-discord-button>Login with Discord</button> <span id=js-discord-status></p> <div class=discord-card id=js-discord-card style=display:none> <img class=discord-card--image id=js-discord-card--image> <div class=discord-card--username id=js-discord-card--username></div> </div> <style>.discord-card--image{margin-left:0!important}</style> <script> const clientID = "798950274114781204";
const redirectUri = "https://f6bfb5.github.io/login-with-discord";
const scope = "identify email"

function handleClick() {
   document.location.href = `https://discord.com/api/oauth2/authorize?client_id=${clientID}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}`;
}

window.addEventListener('load', function() {
   document.getElementById("js-discord-button").addEventListener("click", handleClick);
   // 1. get code from url params
   const urlParams = new URLSearchParams(window.location.search);
   if(urlParams.has("code")) { 
     // 2. post code to get token
     const clientSecret = "3c-TeN5NxElL4la8E6h5BlT4zDHigser";
     const apiUrl = 'https://discordapp.com/api/oauth2/token'
     const data = {
        'client_id': clientID,
        'client_secret': clientSecret,
        'grant_type': 'authorization_code',
        'code': urlParams.get("code"),
        'redirect_uri': redirectUri,
        'scope': scope
     }
     // put payload together
     const formBody = 
     Object.keys(data)
     .map(key => encodeURIComponent(key) 
       + '=' 
       + encodeURIComponent(data[key]))
     .join('&');
     // send post
     const resultData = fetch(apiUrl, {
        method: "POST",
        headers: {
           "content-type": "application/x-www-form-urlencoded"
        },
        body: formBody,
     })
     .then(function(response) {
        if( !response.ok ) {
           throw new Error(response.statusText)
        }
        document.getElementById("js-discord-status").innerText = "token got";
        return response.json()
     })
     // 3. get user data
     .then(function(data) {
        let accessToken = data.access_token;
        const userApiUrl = 'https://discordapp.com/api/users/@me';
        return fetch(userApiUrl, {
           method: "GET",
           headers: {
              "authorization": "Bearer " + accessToken,
           }
        })
     })
     .then(function(response) {
        if( !response.ok ) {
           throw new Error(response.statusText)
        }
        document.getElementById("js-discord-status").innerText = "user data got";
        return response.json();
     })
     .catch(function(error) {
        document.getElementById("js-discord-status").innerText = error;
     })
     // 4. display user data
     resultData.then(function(r) {
        if(r != undefined){
          document.getElementById("js-discord-card").style.display="block";
          document.getElementById("js-discord-card--image").src=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}`;
          document.getElementById("js-discord-card--username").innerText=`${r.username}#${r.discriminator}`
        }
     })
   } else {
      document.getElementById("js-discord-status").innerText = "Not logged in";
   }
}) </script> </article> <div class="back-to-top hidden svelte-142cfra" style=right:2em>Back to top </div> </div></main> <footer class=svelte-1qx4s02><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="noreferrer noopener nofollow">CC BY-SA 4.0.</a> <div class="svelte-1qx4s02 right">Made with <span class="svelte-1qx4s02 heart">❤️</span> and <a href=https://github.com/Charca/sapper-blog-template target=_blank ref="noreferrer noopener nofollow">Sapper</a></div> <div class="svelte-1qx4s02 clearfix"></div> </footer> <a href=https://www.nicovideo.jp/watch/sm35053910 target=_blank rel="noreferrer noopener"><img class="easter-egg svelte-72qmgd" alt=easter_egg src=_c_choju56_0008_s512_choju56_0008_1.png> </a> </div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,{post:{title:"實作「使用 Discord 登入」",slug:"login-with-discord",html:"\u003Cul\u003E\n\u003Cli\u003E\u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fqiita.com\u002Fmasayoshi4649\u002Fitems\u002F46fdb744cb8255f5eb98\"\u003E「Discord の ID でログイン」を実装する(Oauth2) - Qiita\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"1-於-discord-developer-portal-登錄-application\"\u003E1. 於 Discord Developer Portal 登錄 Application\u003C\u002Fh2\u003E\n\u003Ch3 id=\"a-取得-「client-id」和「client-secert」\"\u003Ea. 取得 「Client ID」和「Client Secert」\u003C\u002Fh3\u003E\n\u003Col\u003E\n\u003Cli\u003E登入 \u003Ca target=\"_blank\" rel=\"nofollow\" href=\"https:\u002F\u002Fdiscord.com\u002Fdevelopers\u002Fapplications\"\u003EDiscord Developer Portal\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E點擊右上角的「New Application」\u003C\u002Fli\u003E\n\u003Cli\u003E取名，本文範例取為 \u003Ccode\u003EOAuth Vertify\u003C\u002Fcode\u003E，此名稱會顯示於授權頁面上，之後點擊「Create」\u003C\u002Fli\u003E\n\u003Cli\u003E資訊頁右方的 \u003Ccode\u003EClient ID\u003C\u002Fcode\u003E 和 \u003Ccode\u003EClient Secert\u003C\u002Fcode\u003E 後面也會用到\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch3 id=\"b-建立-oauth-用的網址\"\u003Eb. 建立 OAuth 用的網址\u003C\u002Fh3\u003E\n\u003Col\u003E\n\u003Cli\u003E點擊左側的「OAuth2」分頁\u003C\u002Fli\u003E\n\u003Cli\u003E點擊右側的「Add Redirect」，輸入要用到驗證登入的網址\n\u003Cbr\u002F\u003E例如本文最下方也有附上實作範例\n\u003Cbr\u002F\u003E輸入的網址就是 \u003Ccode\u003Ehttps:\u002F\u002Ff6bfb5.github.io\u002Flogin-with-discord\u002F\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E勾選下方「SCOPE」（索取的資訊欄位）\n裡的「identify」（Discord 的 ID）和「email」\u003C\u002Fli\u003E\n\u003Cli\u003E就可於頁面下方取得認證用的連結\n\u003Cbr\u002F\u003E例：\u003Ccode\u003Ehttps:\u002F\u002Fdiscord.com\u002Fapi\u002Foauth2\u002Fauthorize?client_id=\u003C\u002Fcode\u003ECLIENT ID\u003Ccode\u003E&amp;redirect_uri=\u003C\u002Fcode\u003EREDIRECT URL\u003Ccode\u003E&amp;response_type=code&amp;scope=\u003C\u002Fcode\u003ESCOPE\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2 id=\"2-從認證連結取得「code」\"\u003E2. 從認證連結取得「code」\u003C\u002Fh2\u003E\n\u003Cp\u003E使用此認證連結登入，並重新導向到結果頁面後，網址上會多出一個回傳的 \u003Ccode\u003Ecode\u003C\u002Fcode\u003E 參數\u003C\u002Fp\u003E\n\u003Ch2 id=\"3-使用「code」取得「token」\"\u003E3. 使用「code」取得「token」\u003C\u002Fh2\u003E\n\u003Cp\u003E再使用這個 \u003Ccode\u003Ecode\u003C\u002Fcode\u003E 去取得 \u003Ccode\u003Eaccess_token\u003C\u002Fcode\u003E，才能得到存取資料的權限\u003C\u002Fp\u003E\n\u003Ch3 id=\"a-傳送-post-請求到-discord-api\"\u003Ea. 傳送 POST 請求到 Discord API\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -X POST\n     -H \"Content-Type:application\u002Fx-www-form-urlencoded\"\n     -d \"client_id=CLIENT ID\n     &amp;client_secret=CLIENT SECRET\n     &amp;grant_type=authorization_code\n     &amp;code=CODE\n     &amp;redirect_uri=REDIRECT URL（要與認證 URL 相同）\"\n     https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Foauth2\u002Ftoken\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"b-若成功就可取得-access-token\"\u003Eb. 若成功就可取得 \u003Ccode\u003Eaccess token\u003C\u002Fcode\u003E\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-json\"\u003E\u003Ccode class=\"language-json\"\u003E{\n  \"access_token\": ACCESS TOKEN,\n  \"expires_in\": 604800,\n  \"refresh_token\": REFRESH TOKEN,\n  \"scope\": SCOPE,\n  \"token_type\": \"Bearer\"\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Ecode\u003C\u002Fcode\u003E 為一次性使用，同一個 \u003Ccode\u003Ecode\u003C\u002Fcode\u003E 無法進行第二次存取\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Eaccess token\u003C\u002Fcode\u003E 的有效期限為 604800 秒＝一個禮拜\n\u003Cbr\u003E若有更新需求，須使用回傳內容中的 \u003Ccode\u003Erefresh token\u003C\u002Fcode\u003E 重新送出請求\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"4-使用「token」取得使用者資料\"\u003E4. 使用「token」取得使用者資料\u003C\u002Fh2\u003E\n\u003Ch3 id=\"a-傳送-get-請求到-discord-api\"\u003Ea. 傳送 GET 請求到 Discord API\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -H \"Authorization: Bearer ACCESS TOKEN\"\n     https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Fusers\u002F@me\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"b-若順利成功，就可取得相關資料\"\u003Eb. 若順利成功，就可取得相關資料\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-json\"\u003E\u003Ccode class=\"language-json\"\u003E{\n   \"id\": Discord ID,\n   \"username\": 使用者名稱,\n   \"avatar\": 大頭貼 ID,\n   \"discriminator\": 使用者編號（在名稱#後面的數字）,\n   \"public_flags\": 0,\n   \"flags\": 0,\n   \"email\": 信箱,\n   \"verified\": true,\n   \"locale\": 使用語言,\n   \"mfa_enabled\": false\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\n\u003Cli\u003E頭像可以使用「\u003Ccode\u003Ehttps:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F\u003C\u002Fcode\u003EDiscord ID\u003Ccode\u003E\u002F\u003C\u002Fcode\u003E大頭貼 ID」取得\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2 id=\"5-使用-refresh-token-重新取得-access-token\"\u003E5. 使用 refresh token 重新取得 access token\u003C\u002Fh2\u003E\n\u003Ch3 id=\"a-傳送-post-請求到-discord-api-1\"\u003Ea. 傳送 POST 請求到 Discord API\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Ecurl -X POST\n     -H \"Content-Type:application\u002Fx-www-form-urlencoded\"\n     -d \"client_id=CLIENT ID\n     &amp;client_secret=CLIENT SECRET\n     &amp;grant_type=refresh_token\n     &amp;refresh_token=REFRESH TOKEN\"\n     https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Foauth2\u002Ftoken\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3 id=\"b-若成功就可取得-access-token-1\"\u003Eb. 若成功就可取得 access token\u003C\u002Fh3\u003E\n\u003Cpre class=\"language-json\"\u003E\u003Ccode class=\"language-json\"\u003E{\n   \"access_token\": ACCESS TOKEN,\n   \"expires_in\": 604800,\n   \"refresh_token\": REFRESH TOKEN,\n   \"scope\": SCOPE,\n   \"token_type\": \"Bearer\"\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch2 id=\"範例\"\u003E範例\u003C\u002Fh2\u003E\n\u003Cp\u003E以下示範透過此方式，取得你的 Discord ID 與大頭貼圖片。\n\u003Cbr\u002F\u003E如果未顯示「Not logged in」或點擊按鍵無反應，請重新整理頁面。\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cbutton id=\"js-discord-button\"\u003ELogin with Discord\u003C\u002Fbutton\u003E\n\u003Cspan id=\"js-discord-status\" \u002F\u003E\u003C\u002Fp\u003E\n\u003Cdiv class=\"discord-card\" id=\"js-discord-card\" style=\"display: none\"\u003E\n  \u003Cimg class=\"discord-card--image\" id=\"js-discord-card--image\"\u003E\n  \u003Cdiv class=\"discord-card--username\" id=\"js-discord-card--username\"\u003E\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\u003Cstyle\u003E\n.discord-card--image {\n  margin-left: 0 !important;\n}\n\u003C\u002Fstyle\u003E\n\n\u003Cscript\u003E\nconst clientID = \"798950274114781204\";\nconst redirectUri = \"https:\u002F\u002Ff6bfb5.github.io\u002Flogin-with-discord\";\nconst scope = \"identify email\"\n\nfunction handleClick() {\n   document.location.href = `https:\u002F\u002Fdiscord.com\u002Fapi\u002Foauth2\u002Fauthorize?client_id=${clientID}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${encodeURIComponent(scope)}`;\n}\n\nwindow.addEventListener('load', function() {\n   document.getElementById(\"js-discord-button\").addEventListener(\"click\", handleClick);\n   \u002F\u002F 1. get code from url params\n   const urlParams = new URLSearchParams(window.location.search);\n   if(urlParams.has(\"code\")) { \n     \u002F\u002F 2. post code to get token\n     const clientSecret = \"3c-TeN5NxElL4la8E6h5BlT4zDHigser\";\n     const apiUrl = 'https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Foauth2\u002Ftoken'\n     const data = {\n        'client_id': clientID,\n        'client_secret': clientSecret,\n        'grant_type': 'authorization_code',\n        'code': urlParams.get(\"code\"),\n        'redirect_uri': redirectUri,\n        'scope': scope\n     }\n     \u002F\u002F put payload together\n     const formBody = \n     Object.keys(data)\n     .map(key =\u003E encodeURIComponent(key) \n       + '=' \n       + encodeURIComponent(data[key]))\n     .join('&');\n     \u002F\u002F send post\n     const resultData = fetch(apiUrl, {\n        method: \"POST\",\n        headers: {\n           \"content-type\": \"application\u002Fx-www-form-urlencoded\"\n        },\n        body: formBody,\n     })\n     .then(function(response) {\n        if( !response.ok ) {\n           throw new Error(response.statusText)\n        }\n        document.getElementById(\"js-discord-status\").innerText = \"token got\";\n        return response.json()\n     })\n     \u002F\u002F 3. get user data\n     .then(function(data) {\n        let accessToken = data.access_token;\n        const userApiUrl = 'https:\u002F\u002Fdiscordapp.com\u002Fapi\u002Fusers\u002F@me';\n        return fetch(userApiUrl, {\n           method: \"GET\",\n           headers: {\n              \"authorization\": \"Bearer \" + accessToken,\n           }\n        })\n     })\n     .then(function(response) {\n        if( !response.ok ) {\n           throw new Error(response.statusText)\n        }\n        document.getElementById(\"js-discord-status\").innerText = \"user data got\";\n        return response.json();\n     })\n     .catch(function(error) {\n        document.getElementById(\"js-discord-status\").innerText = error;\n     })\n     \u002F\u002F 4. display user data\n     resultData.then(function(r) {\n        if(r != undefined){\n          document.getElementById(\"js-discord-card\").style.display=\"block\";\n          document.getElementById(\"js-discord-card--image\").src=`https:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F${r.id}\u002F${r.avatar}`;\n          document.getElementById(\"js-discord-card--username\").innerText=`${r.username}#${r.discriminator}`\n        }\n     })\n   } else {\n      document.getElementById(\"js-discord-status\").innerText = \"Not logged in\";\n   }\n})\n\u003C\u002Fscript\u003E\n",date:"2021-01-14T00:24:23.000Z",printDate:"January 14, 2021",printReadingTime:"3 min read",tags:["F2E"],image:"https:\u002F\u002Ff6bfb5.github.io\u002Fpreview\u002Flogin-with-discord.png"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');var s=document.createElement("script");try{new Function("if(0)import('')")();s.src="/client/client.d52f6f0b.js";s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main","/client/client.d52f6f0b.js")}document.head.appendChild(s)</script> 