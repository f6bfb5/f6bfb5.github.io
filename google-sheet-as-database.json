{"title":"使用 Google Sheet 做為資料庫","slug":"google-sheet-as-database","html":"<p>Google 所提供的 Sheet API 可以直接將 Sheet 內容轉換成 JSON 格式輸出，\n<br>亦可接受從外部傳進資料，修改 Sheet 裡的內容，\n<br>並且都有提供 CORS 支援，可以免於處理跨域的困擾。</p>\n<p>本文整理了兩種使用方式：</p>\n<ol>\n<li>直接串現有的 API 純讀取</li>\n<li>透過 Google Apps Script 讀取與寫入</li>\n</ol>\n<h2 id=\"1-純讀取（google-sheets-only）\">1. 純讀取（Google Sheets Only）</h2>\n<h3 id=\"表單處理\">表單處理</h3>\n<ol>\n<li>開啟 Google 表單檔案</li>\n<li>點擊「檔案（File）」\n<br>├ →「發佈到網路（Publish to the web）」\n<br>├ → 挑選要發佈的 Sheet，或是發佈整份文件\n<br>└ →「發佈（Publish）」將此表單公開</li>\n<li>複製表單網址裡 <code>[sheet-id]</code> 的部份\n<br>├ （注意：不是發佈頁面的連結網址，是原始 Sheet 的網址）\n<br>└ <code>https://docs.google.com/spreadsheets/d/[sheet-id]/</code></li>\n<li>將 <code>[sheet-id]</code> 貼進下方 Spreadsheets Data API 網址裡的對應處\n<br>├ <code>https://spreadsheets.google.com/feeds/cells/[sheet-id]/[sheet-index]/public/values?alt=json</code>\n<br>├ or <code>https://spreadsheets.google.com/feeds/list/[sheet-id]/[sheet-index]/public/values?alt=json</code>\n<br>└ 預設格式為 xml，我們在後面加上 <code>?alt=json</code> 改為取得 JSON 格式的資料</li>\n<li><code>[sheet-index]</code> 可以指定想要取用整份表單裡的第幾個分頁，\n<br>├ 在一些相關文章裡會看到這邊填上 <code>od6</code>，\n<br>│ 這個用法看起來是 API 的預設值，\n<br>│ 我們可以改為直接填上需要的頁數數字即可\n<br>├ 如: <code>https://spreadsheets.google.com/feeds/cells/[sheet-id]/1/public/values?alt=json</code>\n<br>└ 這就是我們需要的資料庫網址了</li>\n</ol>\n<h3 id=\"接入網頁\">接入網頁</h3>\n<p>我們從 GET 取得的原始資料內容結構為（僅截取較常用到的資訊）：</p>\n<pre class=\"language-json\"><code class=\"language-json\">{\n  \"version\": \"1.0\",\n  \"encoding\": \"UTF-8\",\n  \"feed\": {\n    \"xmlns\": \"http://www.w3.org/2005/Atom\",\n    ...\n    \"title\": {\n      \"type\": \"text\",\n      \"$t\": \"Sheet1\"\n    },\n    \"link\": [...],\n    ...\n    \"entry\": [\n      {\n        \"id\": {...},\n        ...\n      },\n      \"content\": {\n        \"type\": \"text\",\n        \"$t\": \"content\"\n      },\n      \"link\": [...],\n      \"gs$cell\": {\n        \"row\": \"1\",\n        \"col\": \"1\",\n        \"$t\": \"content\"\n      },\n      ...\n    ]\n  }\n}</code></pre><p>主要儲存的內容在 <code>feed.entry.content</code> 或 <code>feed.entry.gs$cell</code> 裡</p>\n<p>我使用的是 <code>axios</code> 搭配 <code>vue</code> 和 <code>Bootstrap</code>\n<br>以 <code>loading</code> 判斷於資料讀取完畢前顯示讀取動畫</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>d-flex justify-content-center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-if</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>loading<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>spinner-border<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>status<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sr-only<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Loading...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-else</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>entry in entries<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ entry.content.$t }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    el<span class=\"token operator\">:</span> <span class=\"token string\">\"#app\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        entries<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n        loading<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        error<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      axios\n        <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n          <span class=\"token string\">\"https://spreadsheets.google.com/feeds/cells/[sheet-id]/1/public/values?alt=json\"</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>entries <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>feed<span class=\"token punctuation\">.</span>entry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>error <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre><p>可以再搭配 <code>filter()</code> 單獨取得每一行（row）資料：</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> rowData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> rowIndex <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nentry\n  <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>gs$cell<span class=\"token punctuation\">.</span>row <span class=\"token operator\">==</span> rowIndex<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> rowData<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>$t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p>或是每一列（col）資料：</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> colData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> colIndex <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nentry\n  <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>gs$cell<span class=\"token punctuation\">.</span>col <span class=\"token operator\">==</span> colIndex<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> colData<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>$t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p>完成！</p>\n<h2 id=\"2-讀取--寫入（google-sheets--google-apps-script）\">2. 讀取 + 寫入（Google Sheets + Google Apps Script）</h2>\n<h3 id=\"簡介\">簡介</h3>\n<ol>\n<li>開啟 Google 表單檔案</li>\n<li>點擊「工具（Tools）」\n<br>└ →「指令碼編輯器（Script editor）」</li>\n<li>撰寫 GAS 上的處理 function\n<br> GAS 預設以\n<br>├ <code>doGet</code> function 處理 GET 要求\n<br>└ <code>doPost</code> function 處理 POST 要求</li>\n<li>點擊「發佈（Publish）」\n<br>├ →「部署為網路應用程式…（Deploy as web app...）」\n<br>├ →「將應用程式執行為（Execute the app as）」選擇「我（Me）」\n<br>├ →「具有應用程式存取權的使用者（Who has access to the app）」\n<br>│ 選擇「任何人，甚至匿名使用者（Anyone, even anonymous）」\n<br>├ →「部署（Deploy）」→「核對權限」→ 選擇授權用的 Google 帳號\n<br>├ →「進階」→「前往（此應用程式名稱）」→ 允許\n<br>└ → 此 app URL 即為讀取與寫入用的網址</li>\n<li>（※重要）更新 GAS 程式後，在重新發佈時「專案版本（Project version）」要選擇「新增（New）」\n<br>├ 既有數字是之前點擊發佈時的版本的程式碼，不會反應最新的修改內容\n<br>└ 改動後一定要選擇「新增」專案版本，才會有效反應</li>\n<li>撰寫網頁部份處理 function</li>\n</ol>\n<h3 id=\"google-app-script\">Google App Script</h3>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 複製 Sheet 網址裡 [sheet-id] 的部份</span>\n<span class=\"token comment\">// https://docs.google.com/spreadsheets/d/[sheet-id]/</span>\n<span class=\"token keyword\">const</span> SpreadSheetID <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 下方的表單名稱</span>\n<span class=\"token keyword\">const</span> sheetName <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">doGet</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>parameter<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> SpreadSheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">openById</span><span class=\"token punctuation\">(</span>SpreadSheetID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> Sheet <span class=\"token operator\">=</span> SpreadSheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetByName</span><span class=\"token punctuation\">(</span>sheetName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// default wouldn't return category row (the first row)</span>\n  <span class=\"token keyword\">const</span> row <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>row <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>row <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> col <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>col <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>col <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> rowRange <span class=\"token operator\">=</span>\n    params<span class=\"token punctuation\">.</span>endRow <span class=\"token operator\">&amp;&amp;</span> params<span class=\"token punctuation\">.</span>row\n      <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>endRow <span class=\"token operator\">-</span> params<span class=\"token punctuation\">.</span>row <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n      <span class=\"token operator\">:</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> colRange <span class=\"token operator\">=</span>\n    params<span class=\"token punctuation\">.</span>endCol <span class=\"token operator\">&amp;&amp;</span> params<span class=\"token punctuation\">.</span>col\n      <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>endCol <span class=\"token operator\">-</span> params<span class=\"token punctuation\">.</span>col <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n      <span class=\"token operator\">:</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastColumn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rowRange <span class=\"token operator\">></span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> rowRange <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>colRange <span class=\"token operator\">></span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastColumn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> colRange <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastColumn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetValues</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> col<span class=\"token punctuation\">,</span> rowRange<span class=\"token punctuation\">,</span> colRange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> ContentService<span class=\"token punctuation\">.</span><span class=\"token function\">createTextOutput</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setMimeType</span><span class=\"token punctuation\">(</span>\n    ContentService<span class=\"token punctuation\">.</span>MimeType<span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">doPost</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>parameter<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> SpreadSheet <span class=\"token operator\">=</span> SpreadsheetApp<span class=\"token punctuation\">.</span><span class=\"token function\">openById</span><span class=\"token punctuation\">(</span>SpreadSheetID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> Sheet <span class=\"token operator\">=</span> SpreadSheet<span class=\"token punctuation\">.</span><span class=\"token function\">getSheetByName</span><span class=\"token punctuation\">(</span>sheetName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> NewRow <span class=\"token operator\">=</span> Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getLastRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// customize data key here</span>\n  <span class=\"token keyword\">const</span> dataKey <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// add Timestamp in the first column</span>\n  Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span>NewRow<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">setNumberFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy/MM/dd hh:mm\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// add data by keys to the last row</span>\n  dataKey<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    Sheet<span class=\"token punctuation\">.</span><span class=\"token function\">getRange</span><span class=\"token punctuation\">(</span>NewRow<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> ContentService<span class=\"token punctuation\">.</span><span class=\"token function\">createTextOutput</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POST success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><p>GAS 有三種回傳資料的方式</p>\n<ol>\n<li>回傳字串</li>\n</ol>\n<p><code>return ContentService.createTextOutput(&quot;GET 回傳字串&quot;);</code></p>\n<ol start=\"2\">\n<li>回傳 HTML</li>\n</ol>\n<p><code>return HtmlService.createHtmlOutput(HTMLString);</code></p>\n<ol start=\"3\">\n<li>回傳 JSON</li>\n</ol>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> JSONString <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> ContentService<span class=\"token punctuation\">.</span><span class=\"token function\">createTextOutput</span><span class=\"token punctuation\">(</span>JSONString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setMimeType</span><span class=\"token punctuation\">(</span>\n  ContentService<span class=\"token punctuation\">.</span>MimeType<span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h3 id=\"網頁取得\">網頁取得</h3>\n<h4 id=\"fetch\">Fetch</h4>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 上面步驟取得的網址</span>\n<span class=\"token keyword\">const</span> appUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>appUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">respons</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// GAS 回傳資料為 JSON 格式時</span>\n    <span class=\"token keyword\">return</span> respons<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">respons</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// response data here</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>respons<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><p>也可以搭配 <code>URLSearchParams</code> 傳入參數，做進一步的取得處理\n參數會傳至 GAS 中的 <code>e.parameter</code> 裡</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 上面步驟取得的網址</span>\n<span class=\"token keyword\">const</span> appUrl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  action<span class=\"token operator\">:</span> <span class=\"token string\">\"getAll\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nappUrl<span class=\"token punctuation\">.</span>search <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>appUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">respons</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// GAS 回傳資料為 JSON 格式時</span>\n    <span class=\"token keyword\">return</span> respons<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">respons</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// response data here</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>respons<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h4 id=\"jquery\">jQuery</h4>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> appUrl <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n$<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>appUrl <span class=\"token operator\">+</span> <span class=\"token string\">\"?action=getAll\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n$<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>appUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    action<span class=\"token operator\">:</span> <span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span>\n    data<span class=\"token operator\">:</span> <span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n$<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n    url<span class=\"token operator\">:</span> appUrl<span class=\"token punctuation\">,</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      action<span class=\"token operator\">:</span> <span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span>\n      data<span class=\"token operator\">:</span> <span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre><h3 id=\"網頁傳送\">網頁傳送</h3>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> appUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  action<span class=\"token operator\">:</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span>\n  data<span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>appUrl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n  body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre><h3 id=\"參考文章\">參考文章</h3>\n<ul>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://medium.com/unalai/%E5%AF%AB%E7%B5%A6%E7%B4%94%E5%89%8D%E7%AB%AF-%E8%AE%93-google-sheets-%E7%95%B6%E4%BD%A0%E7%9A%84%E5%BE%8C%E7%AB%AF%E5%AE%8C%E6%88%90%E5%AF%AB%E5%85%A5%E5%8A%9F%E8%83%BD-715799e5e013\">寫給純前端，讓 Google Sheets 當你的後端完成寫入功能 | by Lai | UnaLai | Medium</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://tutorials.webduino.io/zh-tw/docs/socket/useful/google-sheet-2.html\">Google 試算表 ( 前後端實作 ) - Webduino 實戰智慧插座教學</a></li>\n<li><a target=\"_blank\" rel=\"nofollow\" href=\"https://g0v.hackpad.tw/5Ofw64qSz7P#:h=Google-Spreadsheet\">盤點各種線上協作資料(庫)方案 - g0v.hackpad.tw</a></li>\n</ul>\n","date":"2020-07-23T00:40:12.000Z","excerpt":"Google 所提供的 Sheet API 可以直接將 Sheet 內容轉換成 JSON 格式輸出，亦可接受從外部傳進資料，修改 Sheet 裡的內容，並且都有提供 CORS 支援，可以免於處理跨域的困擾。","printDate":"July 23, 2020","printReadingTime":"4 min read","tags":[]}